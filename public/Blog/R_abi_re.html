<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Machine Learning in Action: ab1 file | Karobben</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="How to heck into ab1 data with R or Python">
<meta property="og:type" content="website">
<meta property="og:title" content="Machine Learning in Action: ab1 file">
<meta property="og:url" content="https://karobben.github.io/Blog/R_abi_re.html">
<meta property="og:site_name" content="Karobben">
<meta property="og:description" content="How to heck into ab1 data with R or Python">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/06/wmCyRJ.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/13/w0wYC9.md.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/13/w0Dc8J.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/13/w0Dg29.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/13/w0zooq.md.png">
<meta property="article:published_time" content="2020-09-12T16:00:00.000Z">
<meta property="article:modified_time" content="2020-10-05T15:21:56.187Z">
<meta property="article:author" content="Karobben">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/09/06/wmCyRJ.md.png">
  
    <link rel="alternate" href="/atom.xml" title="Karobben" type="application/atom+xml">
  
  
    <link rel="icon" href="img/tag.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/search.css">

  <script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  <style>
  pre {
    color: salmon;
  }
  </style>
<meta name="generator" content="Hexo 4.2.1"></head>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?8442e6ecc87d878298ba7d3bd0a5484c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header"; style="background:#1B414B;height:150px">
  <!--div id="banner"></div>-->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Karobben</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Karobben Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <!-- Header Section Start -->
  <header id="slider-area">
    <nav class="navbar navbar-expand-md fixed-top scrolling-navbar bg-white">
      <div class="container">
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto w-100 justify-content-end">
              <a class="main-nav-link" href="../index.html">Home</a>
              <a class="main-nav-link" href="../R/R-index.html">R</a>
              <a class="main-nav-link" href="../Python/index.html">Python</a>
              <a class="main-nav-link" href="../Linux/index.html">Linux</a>
              <a class="main-nav-link" href="../Bioinfor/index.html">Bio-Protocal</a>
              <a class="main-nav-link" href="../LearnNotes/index.html">Notes</a>
              <a class="main-nav-link" href="../Blog/index.html">Others</a>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <!-- Header Section End -->

      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Looking for Something?"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://karobben.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><div align='right', style='padding-right:160px;padding-top:1px'>
  
  <span class="local-search local-search-google local-search-plugin" style=";position:absolute;z-index:2;">
      <input type="search" placeholder="Looking for Something?" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>


</div>

<article  id="page-" class="article article-type-page" itemscope itemprop="blogPost">
<div id="tipue_search_content" style="display: none"></div>
  <div class="article-meta">
    <a href="/Blog/R_abi_re.html" class="article-date">
  <time datetime="2020-09-12T16:00:00.000Z" itemprop="datePublished">2020-09-13</time>
</a>
    
  </div>
  <div  class="article-inner">
    
    
      <header class="article-header">
        <!--
  
    <h1 class="article-title" itemprop="name">
      Machine Learning in Action: ab1 file
    </h1>
  
 -->
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Go To Top Link -->
        <div title="Back to Top" class="back-to-top" style="background:salmon">
  <a href="#"  >
    <i >Top</i>
  </a>
</div>
<div class="title_index">
  <ul id="nav">
   <li>
     Titles
     <ul>
       <!-- Table of Contents -->

  <div id="toc" class="toc-article">
    <strong class="toc-title">Titles</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">Machine Learning in Action: ab1 raw data</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">Familiar with Your Data</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linear-Regression"><span class="toc-number">2.1.</span> <span class="toc-text">Linear Regression</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Logarithmic-Regression"><span class="toc-number">2.2.</span> <span class="toc-text">Logarithmic Regression</span></a></li></ol></li></ol>
  </div>

<!-- Table of Contents Down-->

     </ul>
    </li>
   </ul>
</div>


        <h1>Machine Learning in Action: ab1 raw data</h1>
<p>At present, I’m working for a DNA sequencing company.</p>
<p>The experiment is not hard for me. But the head-breaking part is analyzing the results for a freshman: there are so many!</p>
<p>Traditionally, we can use <em><strong>Sequencing Analyzing</strong></em> to view the signal of electrophics. But there are 96 wells for each plate, and we have several plates in each day. It is hard to imagine checking the graphics one by one especially we have work to do.</p>
<p>For solving this problem, I tried R and python both. But <code>ggplot2</code> is just fucking slow for massive data (As we know, for each plate, there are 96 wells. Each well has 4 signal tunnels, and each tunnel contains about 17,000 check-point. As a result, there are about 6.5 million points to plot). It takes about 2 mins for R to collect all matrix, plot, and save it. But python works much fluently.</p>
<p>Let’s see an example of the plot.<br>
<a href="https://imgchr.com/i/wmCyRJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/09/06/wmCyRJ.md.png" alt="wmCyRJ.md.png"></a></p>
<h1>Familiar with Your Data</h1>
<p>As we can see the result below, we have few types of pattern judged by the naked eyes:</p>
<ul>
<li>A01: Triangle. (The signal is decreasing but is still readable)</li>
<li>A02: Flat. (Which doesn’t have signal at all)</li>
<li>A08: Laying-Trapezoid. (The perfect result we’d love to)</li>
<li>F01~F07: Acute Triangle. (Which means the signal is decreasing and the result is unreadable)</li>
<li>C02: Stick. (Short sequence or Signal-Break due to some reasons.)</li>
</ul>
<p>Though, it is easy to acquire a model from ML by putting all those check-point into a matrix and training them. But I decided to reduce the burden of my computer.</p>
<p>By first, I’d like to try something like linear regression.</p>
<h2 id="Linear-Regression"><a class="header-anchor" href="#Linear-Regression"></a>Linear Regression</h2>
<p>First, Let’s take a quick look of the <em>smooth line</em><br>
<a href="https://imgchr.com/i/w0wYC9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/09/13/w0wYC9.md.png" alt="w0wYC9.md.png"></a></p>
<p>Now, let’s try the linear regression.<br>
Main codes can be found at my <a href="https://karobben.github.io/R/regression.html">blog</a></p>
<p>Let’s take the well H12 as an example<br>
By using <code>geom_smooth</code> from <code>ggplot2</code>, we can achieve these graphics easily.<br>
<img src="https://s1.ax1x.com/2020/09/13/w0Dc8J.png" alt="w0Dc8J.png"></p>
<p>By calculating the regression function by <code>lm</code> from exponent from 1 to 13, we can get the result as below<br>
<img src="https://s1.ax1x.com/2020/09/13/w0Dg29.png" alt="w0Dg29.png"><br>
<strong>An example of regression function</strong>:<br>
$$<br>
f(x)= -5.33506521414874 e^{-56} * x^{13}+2.33068989275763 e^{-50} * x^{12}<br>
$$<br>
$$<br>
-4.44202743547308 e^{-45} * x^{11}+4.8269078976017 e^{-40} * x^{10}<br>
$$<br>
$$<br>
-3.27011035492282 e^{-35} * x^9+1.40852725678933 e^{-30} * x^8<br>
$$<br>
$$<br>
-3.68400537011035 e^{-26} * x^7+4.64218496851634 e^{-22} * x^6<br>
$$<br>
$$<br>
+2.12911181720032 e^{-18} * x^5-1.64587230405762 e^{-13} * x^4<br>
$$<br>
$$<br>
+2.2678114895877 e^{-09} * x^3-1.27776012720345 e^{-05} * x^2<br>
$$<br>
$$<br>
+0.0270106008326289 * x^1 -8.24054735022609<br>
$$</p>
<p>As we can see, the last diagram is almost about the same as the result of <code>geom_smooth</code>!</p>
<p>Another awesome thing is it takes only a second to get the result!!</p>
<p>As we can see, the function of linear-regression is enough to tell us about that this well is failed or succeed and we can use the numbers from it to train our model!</p>
<p>Let’s check all the regression plot</p>
<p><a href="https://imgchr.com/i/w0zooq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/09/13/w0zooq.md.png" alt="w0zooq.md.png"></a></p>
<p>It looks well, but it takes long time to make.</p>
<details>
  <summary style="color:salmon">Click to see hidden codes</summary>
  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(sangerseqR)</span><br><span class="line"><span class="keyword">library</span>(reshape2)</span><br><span class="line"></span><br><span class="line">mylr = <span class="keyword">function</span>(x,y)&#123;</span><br><span class="line">  x_mean = mean(x)</span><br><span class="line">  y_mean = mean(y)</span><br><span class="line">  xy_mean = mean(x*y)</span><br><span class="line">  xx_mean = mean(x*x)</span><br><span class="line">  yy_mean = mean(y*y)</span><br><span class="line"></span><br><span class="line">  m = (x_mean*y_mean - xy_mean)/(x_mean^<span class="number">2</span> - xx_mean)</span><br><span class="line">  b = y_mean - m*x_mean</span><br><span class="line"></span><br><span class="line">  f = m*x+b<span class="comment"># 线性回归方程</span></span><br><span class="line">  sst = sum((y-y_mean)^<span class="number">2</span>)</span><br><span class="line">  sse = sum((y-f)^<span class="number">2</span>)</span><br><span class="line">  ssr = sum((f-y_mean)^<span class="number">2</span>)</span><br><span class="line">  result = c(m,b,sst,sse,ssr)</span><br><span class="line">  names(result) = c(<span class="string">'m'</span>,<span class="string">'b'</span>,<span class="string">'sst'</span>,<span class="string">'sse'</span>,<span class="string">'ssr'</span>)</span><br><span class="line">  result[<span class="string">'ssr'</span>]/result[<span class="string">'sst'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">F_equation &lt;- <span class="keyword">function</span>(X,Formula)&#123;</span><br><span class="line">  eval(parse(text = Formula))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LMEE &lt;- <span class="keyword">function</span>(TB,Times)&#123;</span><br><span class="line">  colnames(TB)=c(<span class="string">"X"</span>,<span class="string">"Y"</span>)</span><br><span class="line"></span><br><span class="line">  Group_X = <span class="string">"X"</span></span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> c(<span class="number">2</span>:Times))&#123;</span><br><span class="line">    X_i = paste(<span class="string">"I(X^"</span>,i,<span class="string">")"</span>,sep=<span class="string">""</span>)</span><br><span class="line">    Group_X = paste(Group_X,X_i,sep=<span class="string">" + "</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  str_lm = paste(<span class="string">"lm(Y ~"</span>,Group_X, <span class="string">', data=TB)'</span>, sep=<span class="string">' '</span>)</span><br><span class="line">  model = eval(parse(text = str_lm))</span><br><span class="line"></span><br><span class="line">  Formula = model$coefficients[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> c(Times:<span class="number">1</span>))&#123;</span><br><span class="line">    X_tmp = paste(model$coefficients[i+<span class="number">1</span>], <span class="string">" * X^"</span>, i, sep=<span class="string">""</span>)</span><br><span class="line">    Formula = paste(Formula,X_tmp,sep=<span class="string">"+"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  R2 = mylr(TB$Y,F_equation(TB$X,Formula))</span><br><span class="line"></span><br><span class="line">  result = c()</span><br><span class="line">  result$R2 = R2[[<span class="number">1</span>]]</span><br><span class="line">  result$model = model</span><br><span class="line">  result$Formula=Formula</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MEES &lt;- <span class="keyword">function</span>(TB, Times)&#123;</span><br><span class="line">  colnames(TB)=c(<span class="string">"X"</span>,<span class="string">"Y"</span>)</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> c(<span class="number">1</span>:Times))&#123;</span><br><span class="line">    Result = c()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">1</span>)&#123;</span><br><span class="line">      model &lt;- lm(formula = Y ~ X, data = TB)</span><br><span class="line">      Formula = paste(model$coefficients[<span class="number">1</span>],<span class="string">" + "</span>, model$coefficients[<span class="number">2</span>],<span class="string">" * X"</span>, sep=<span class="string">""</span>)</span><br><span class="line">      R2 = mylr(TB$Y,F_equation(TB$X,Formula))</span><br><span class="line">      Result_TB = data.frame(Exp=i,R2=R2, <span class="literal">F</span> = Formula)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      Result_LMEE = LMEE(TB,i)</span><br><span class="line">      Result_tmp = data.frame(Exp= i, R2= Result_LMEE$R2, <span class="literal">F</span> = Result_LMEE$Formula)</span><br><span class="line">      Result_TB = rbind(Result_TB, Result_tmp)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(Result_TB)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MEES_plot &lt;- <span class="keyword">function</span>(TB,Result_TB,header=<span class="string">"test"</span>)&#123;</span><br><span class="line">  MAIN = as.character(TB$tube[<span class="number">1</span>])</span><br><span class="line">  colnames(TB)=c(<span class="string">"X"</span>,<span class="string">"Y"</span>)</span><br><span class="line">  Result_TB = na.omit(Result_TB)</span><br><span class="line">  Exp = nrow(Result_TB)</span><br><span class="line">  Result_TB = Result_TB[order(Result_TB$R2, decreasing = <span class="literal">T</span>)[<span class="number">1</span>],]</span><br><span class="line">  X = unique(as.integer(TB$X/<span class="number">100</span>))*<span class="number">100</span></span><br><span class="line">  plot(X, F_equation(X,as.character(Result_TB$<span class="literal">F</span>)),type=<span class="string">'p'</span>,</span><br><span class="line">  main = paste(MAIN, Exp),</span><br><span class="line">  xlab = <span class="string">""</span>,</span><br><span class="line">  ylab = <span class="string">""</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TB_get &lt;- <span class="keyword">function</span>(ab1)&#123;</span><br><span class="line">  A &lt;- read.abif(ab1)</span><br><span class="line">  A_raw = A@data$DATA.1</span><br><span class="line">  T_raw = A@data$DATA.2</span><br><span class="line">  C_raw = A@data$DATA.3</span><br><span class="line">  G_raw = A@data$DATA.4</span><br><span class="line">  tmp &lt;- melt(t(data.frame(A_raw,T_raw,C_raw, G_raw)))</span><br><span class="line">  <span class="keyword">return</span>(list(tmp, A@data$TUBE.1))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">png(<span class="string">'../test.png'</span>,w=<span class="number">1920</span>*<span class="number">1.3</span>,h=<span class="number">1080</span>*<span class="number">1.3</span>)</span><br><span class="line">par(mfrow=c(<span class="number">8</span>,<span class="number">12</span>))</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> dir())&#123;</span><br><span class="line">  print(i)</span><br><span class="line">  TB_tmp = TB_get(i)[[<span class="number">1</span>]]</span><br><span class="line">  TUBE = TB_get(i)[[<span class="number">2</span>]]</span><br><span class="line">  TB = data.frame(X=c(<span class="number">1</span>:nrow(TB_tmp)),Y=TB_tmp$value, tube=TUBE)</span><br><span class="line">  MEES_plot(TB,MEES(TB,<span class="number">20</span>))</span><br><span class="line">&#125;</span><br><span class="line">dev.off()</span><br></pre></td></tr></table></figure></div>
</details>
<h2 id="Logarithmic-Regression"><a class="header-anchor" href="#Logarithmic-Regression"></a>Logarithmic Regression</h2>
<p>$$<br>
f(x) = log(x)+B<br>
$$</p>
<details>
  <summary style="color:salmon">Click to see hidden codes</summary>
  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">library</span>(sangerseqR)</span><br><span class="line">  <span class="keyword">library</span>(reshape2)</span><br><span class="line"></span><br><span class="line">  mylr = <span class="keyword">function</span>(x,y)&#123;</span><br><span class="line">    x_mean = mean(x)</span><br><span class="line">    y_mean = mean(y)</span><br><span class="line">    xy_mean = mean(x*y)</span><br><span class="line">    xx_mean = mean(x*x)</span><br><span class="line">    yy_mean = mean(y*y)</span><br><span class="line"></span><br><span class="line">    m = (x_mean*y_mean - xy_mean)/(x_mean^<span class="number">2</span> - xx_mean)</span><br><span class="line">    b = y_mean - m*x_mean</span><br><span class="line"></span><br><span class="line">    f = m*x+b<span class="comment"># 线性回归方程</span></span><br><span class="line">    sst = sum((y-y_mean)^<span class="number">2</span>)</span><br><span class="line">    sse = sum((y-f)^<span class="number">2</span>)</span><br><span class="line">    ssr = sum((f-y_mean)^<span class="number">2</span>)</span><br><span class="line">    result = c(m,b,sst,sse,ssr)</span><br><span class="line">    names(result) = c(<span class="string">'m'</span>,<span class="string">'b'</span>,<span class="string">'sst'</span>,<span class="string">'sse'</span>,<span class="string">'ssr'</span>)</span><br><span class="line">    result[<span class="string">'ssr'</span>]/result[<span class="string">'sst'</span>]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  TB_get &lt;- <span class="keyword">function</span>(ab1)&#123;</span><br><span class="line">    A &lt;- read.abif(ab1)</span><br><span class="line">    A_raw = A@data$DATA.1</span><br><span class="line">    T_raw = A@data$DATA.2</span><br><span class="line">    C_raw = A@data$DATA.3</span><br><span class="line">    G_raw = A@data$DATA.4</span><br><span class="line">    tmp &lt;- melt(t(data.frame(A_raw,T_raw,C_raw, G_raw)))</span><br><span class="line">    <span class="keyword">return</span>(list(tmp, A@data$TUBE.1))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Result = c()</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> dir())&#123;  </span><br><span class="line">    A &lt;- TB_get(i)</span><br><span class="line">    Y = A[[<span class="number">1</span>]]$value[-c(<span class="number">1</span>:<span class="number">12000</span>)]</span><br><span class="line">    TB &lt;- data.frame(X=c(<span class="number">1</span>: length(Y)), Y = Y)</span><br><span class="line">    Model &lt;- lm(formula = Y ~ log(X), data = TB)</span><br><span class="line">    Cur &lt;- Model$coefficients[[<span class="number">2</span>]]</span><br><span class="line">    R2 &lt;- mylr(TB$Y, Model$coefficients[[<span class="number">1</span>]] + Model$coefficients[[<span class="number">2</span>]]*log(TB$X))</span><br><span class="line">    <span class="comment">#print(paste(Cur, R2))</span></span><br><span class="line">    Result &lt;- c(Result, Cur,R2)</span><br><span class="line">  &#125;</span><br><span class="line">  Result &lt;- data.frame(matrix(Result, ncol = <span class="number">2</span> , byrow = <span class="literal">T</span>))</span><br><span class="line">  Di = rep(<span class="number">0</span>,<span class="number">96</span>)</span><br><span class="line">  Di[Result$X1&lt; -<span class="number">10</span>] = <span class="number">1</span></span><br><span class="line">  Di[Result$X2 &lt; <span class="number">0.1</span>] = <span class="number">0</span></span><br><span class="line">  pheatmap::pheatmap(matrix(Di, ncol = <span class="number">12</span>, byrow = <span class="literal">T</span>), cluster_rows = <span class="literal">F</span>, cluster_cols = <span class="literal">F</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">png(<span class="string">'../test2.png'</span>,w=<span class="number">1920</span>*<span class="number">1.3</span>,h=<span class="number">1080</span>*<span class="number">1.3</span>)</span><br><span class="line">par(mfrow=c(<span class="number">8</span>,<span class="number">12</span>))</span><br><span class="line">Result &lt;-c()</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> dir())&#123;</span><br><span class="line">  print(i)</span><br><span class="line">  A &lt;- read.abif(i)</span><br><span class="line">  A_raw = A@data$DATA.1</span><br><span class="line">  T_raw = A@data$DATA.2</span><br><span class="line">  C_raw = A@data$DATA.3</span><br><span class="line">  G_raw = A@data$DATA.4</span><br><span class="line">  tmp &lt;- melt(t(data.frame(A_raw,T_raw,C_raw, G_raw)))</span><br><span class="line">  Num =<span class="number">100</span></span><br><span class="line">  Y = apply(matrix(tmp$value, ncol=<span class="number">4</span>*Num, byrow = <span class="literal">T</span>),<span class="number">1</span>,max)</span><br><span class="line">  X = c(<span class="number">1</span>:length(apply(matrix(tmp$value, ncol=<span class="number">4</span>*Num, byrow = <span class="literal">T</span>),<span class="number">1</span>,max)))</span><br><span class="line">  TB = data.frame(X=X,Y=Y)</span><br><span class="line">  Model &lt;- lm(formula = Y ~ log(X), data = TB)</span><br><span class="line">  Cur &lt;- Model$coefficients[[<span class="number">2</span>]]</span><br><span class="line">  R2 &lt;- mylr(TB$Y, Model$coefficients[[<span class="number">1</span>]] + Model$coefficients[[<span class="number">2</span>]]*log(TB$X))</span><br><span class="line">  <span class="comment">#print(paste(Cur, R2))</span></span><br><span class="line">  Result &lt;- c(Result, Cur,R2)</span><br><span class="line">  plot(X,Y)</span><br><span class="line">&#125;</span><br><span class="line">dev.off()</span><br><span class="line">Result &lt;- data.frame(matrix(Result, ncol = <span class="number">2</span> , byrow = <span class="literal">T</span>))</span><br><span class="line"></span><br><span class="line">Di = rep(<span class="number">1</span>,<span class="number">96</span>)</span><br><span class="line">Di[Result$X1&gt; -<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">Di[Result$X2 &lt; <span class="number">0.1</span>] = <span class="number">0</span></span><br><span class="line">pheatmap::pheatmap(matrix(Di, ncol = <span class="number">12</span>, byrow = <span class="literal">T</span>), cluster_rows = <span class="literal">F</span>, cluster_cols = <span class="literal">F</span>)</span><br></pre></td></tr></table></figure></div>
</details>
<br>
<p>Waiting for updating…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://karobben.github.io/Blog/R_abi_re.html" data-id="ckf0r97nc0001g2fc9lwhc8pm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/30/tmp/">test</a>
          </li>
        
      </ul>
    </div>
  </div>

  
  <!-- Weather -->
<div id="weather-view-he" ></div>
<script>
WIDGET = {ID: 'HfP68rcshb'};
</script>
<script type="text/javascript" src="https://apip.weatherdt.com/view/static/js/r.js?v=1111"></script>

</aside>

          <!-- Weather Plug -->
        
        <!--git talk-->
        <section id="main">
          <div style='padding-top:10px'>
  <div style="background:white">
    <script src="https://utteranc.es/client.js"
            repo="Karobben/utterances"
            issue-term="pathname"
            theme="preferred-color-scheme"
            crossorigin="anonymous"
            async>
    </script>
  </div>
</div>
<!--git talk-->
  <!-- Link Gitalk 的支持文件  -->
  <!--
    <div>
      <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
      <div id="gitalk-container"></div>     <script type="text/javascript">
          var gitalk = new Gitalk({

          // gitalk的主要参数
              clientID: '96c208ade65e80e3aaac',
              clientSecret: '86e9240674a3815b0ddc31dababdb4998d5562f4',
              repo: 'OAuth-Application',
              owner: 'Karobben',
              admin: ['Karobben'],
              id:window.location.pathname,
          });
          gitalk.render('gitalk-container');
      </script>
    </div>
<!-- Gitalk end -->

        </section>
        <!-- Gitalk end -->

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <span style="float:right; list-style:none">
        <a style="padding: 10px" href="https://karobben.github.io/">Blog</a>
        <a style="padding: 10px" href="https://github.com/Karobben" target="_blank" rel="noopener">GitHub</a>
        <br>
        <a style="padding: 10px" href="https://space.bilibili.com/393056819" target="_blank" rel="noopener">BiliBili</a>
        <a href="mailto:a591465908@outlook.com">Mail me</a>
      </span>
      &copy; Karobben 2020<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
  <span>
    <p align = "center">
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_site_pv">~<span id="busuanzi_value_site_pv"></span>~</span>
    </p>
  </span>
</footer>

    </div>
    <nav id="mobile-nav">
  <!--`
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  -->
  <a class="mobile-nav-link" href="../index.html">Home</a>
  <a class="mobile-nav-link" href="../R/R-index.html">R</a>
  <a class="mobile-nav-link" href="../Python/index.html">Python</a>
  <a class="mobile-nav-link" href="../Linux/index.html">Linux</a>
  <a class="mobile-nav-link" href="../Bioinfor/index.html">Bio-Protocal</a>
  <a class="mobile-nav-link" href="../LearnNotes/index.html">Notes</a>
  <a class="mobile-nav-link" href="../Blog/index.html">Others</a>
</nav>

    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




<!--mermaid module-->

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>



<!-- Searche Module-->
<script src="/js/search.js"></script>
<script src="/js/load.js"></script>
<!-- 这里可能有一些其他原来文件里的代码，也可以没有 -->

  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
