<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Edger | Karobben</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Edger">
<meta property="og:type" content="website">
<meta property="og:title" content="Edger">
<meta property="og:url" content="https://karobben.github.io/R/edgeR.html">
<meta property="og:site_name" content="Karobben">
<meta property="og:description" content="Edger">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-08-13T09:20:10.686Z">
<meta property="article:modified_time" content="2020-08-13T09:20:10.686Z">
<meta property="article:author" content="Karobben">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Karobben" type="application/atom+xml">
  
  
    <link rel="icon" href="img/tag.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/search.css">

  <script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  <style>
  pre {
    color: salmon;
  }
  </style>
<meta name="generator" content="Hexo 4.2.1"></head>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?8442e6ecc87d878298ba7d3bd0a5484c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header"; style="background:#1B414B;height:150px">
  <!--div id="banner"></div>-->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Karobben</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Karobben Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <!-- Header Section Start -->
  <header id="slider-area">
    <nav class="navbar navbar-expand-md fixed-top scrolling-navbar bg-white">
      <div class="container">
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto w-100 justify-content-end">
              <a class="main-nav-link" href="../index.html">Home</a>
              <a class="main-nav-link" href="../R/R-index.html">R</a>
              <a class="main-nav-link" href="../Python/index.html">Python</a>
              <a class="main-nav-link" href="../Linux/index.html">Linux</a>
              <a class="main-nav-link" href="../Bioinfor/index.html">Bio-Protocal</a>
              <a class="main-nav-link" href="../LearnNotes/index.html">Notes</a>
              <a class="main-nav-link" href="../Blog/index.html">Others</a>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <!-- Header Section End -->

      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Looking for Something?"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://karobben.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><div align='right', style='padding-right:160px;padding-top:1px'>
  
  <span class="local-search local-search-google local-search-plugin" style=";position:absolute;z-index:2;">
      <input type="search" placeholder="Looking for Something?" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>


</div>

<article  id="page-" class="article article-type-page" itemscope itemprop="blogPost">
<div id="tipue_search_content" style="display: none"></div>
  <div class="article-meta">
    <a href="/R/edgeR.html" class="article-date">
  <time datetime="2020-08-13T09:20:10.686Z" itemprop="datePublished">2020-08-13</time>
</a>
    
  </div>
  <div  class="article-inner">
    
    
      <header class="article-header">
        <!--
  
    <h1 class="article-title" itemprop="name">
      Edger
    </h1>
  
 -->
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Go To Top Link -->
        <div title="Back to Top" class="back-to-top" style="background:salmon">
  <a href="#"  >
    <i >Top</i>
  </a>
</div>
<div class="title_index">
  <ul id="nav">
   <li>
     Titles
     <ul>
       <!-- Table of Contents -->

  <div id="toc" class="toc-article">
    <strong class="toc-title">Titles</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">Edger</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">2.</span> <span class="toc-text">Example form Trinity</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Expression-Differential"><span class="toc-number">2.1.</span> <span class="toc-text">Expression Differential</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test"><span class="toc-number">2.2.</span> <span class="toc-text">Test</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">edgeR(out of date)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">4.</span> <span class="toc-text">Attachment</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#heatmap-3-R"><span class="toc-number">4.1.</span> <span class="toc-text">heatmap.3.R</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc-rnaseq-funcs-R"><span class="toc-number">4.2.</span> <span class="toc-text">misc_rnaseq_funcs.R</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pairs3-R"><span class="toc-number">4.3.</span> <span class="toc-text">pairs3.R</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vioplot2-R"><span class="toc-number">4.4.</span> <span class="toc-text">vioplot2.R</span></a></li></ol></li></ol>
  </div>

<!-- Table of Contents Down-->

     </ul>
    </li>
   </ul>
</div>


        <h1>Edger</h1>
<h1>Example form Trinity</h1>
<h2 id="Expression-Differential"><a class="header-anchor" href="#Expression-Differential"></a>Expression Differential</h2>
<p>Attention:</p>
<ul>
<li>Make sure Trinity is installed because this scripts needs few functions from re-packaged scripts.</li>
<li>If you didn’t install the Trinity, please download <em>heatmap.3.R</em> <em>misc_rnaseq_funcs</em> <em>pairs3.R</em> <em>vioplot2.R</em> from <a href="https://github.com/trinityrnaseq/trinityrnaseq/tree/master/Analysis/DifferentialExpression/R" target="_blank" rel="noopener">Github</a>, or paste them to your codes instead of source them. (I paste this three codes at the end of the page)</li>
<li>This script is running the differential expression <strong>counts</strong>. So, make sure you are handling an appropriate matrix.</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(cluster)</span><br><span class="line"><span class="keyword">library</span>(Biobase)</span><br><span class="line"><span class="keyword">library</span>(qvalue)</span><br><span class="line"><span class="keyword">library</span>(fastcluster)</span><br><span class="line">options(stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">NO_REUSE = <span class="literal">F</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># try to reuse earlier-loaded data if possible</span></span><br><span class="line"><span class="keyword">if</span> (file.exists(<span class="string">"diffExpr.P1e-5_C2.matrix.RData"</span>) &amp;&amp; ! NO_REUSE) &#123;</span><br><span class="line">    print(<span class="string">'RESTORING DATA FROM EARLIER ANALYSIS'</span>)</span><br><span class="line">    load(<span class="string">"diffExpr.P1e-5_C2.matrix.RData"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment"># loading Count matrix</span></span><br><span class="line">    print(<span class="string">'Reading matrix file.'</span>)</span><br><span class="line">    primary_data = read.table(<span class="string">"diffExpr.P1e-5_C2.matrix"</span>, header=<span class="literal">T</span>, com=<span class="string">''</span>, row.names=<span class="number">1</span>, check.names=<span class="literal">F</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">    primary_data = as.matrix(primary_data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># reading repackaged R function from scripts</span></span><br><span class="line"><span class="comment"># similar like import File/lib.py in python</span></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"/home/ken/Biosoft/trinityrnaseq-Trinity-v2.8.4/Analysis/DifferentialExpression/R/heatmap.3.R"</span>)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"/home/ken/Biosoft/trinityrnaseq-Trinity-v2.8.4/Analysis/DifferentialExpression/R/misc_rnaseq_funcs.R"</span>)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"/home/ken/Biosoft/trinityrnaseq-Trinity-v2.8.4/Analysis/DifferentialExpression/R/pairs3.R"</span>)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"/home/ken/Biosoft/trinityrnaseq-Trinity-v2.8.4/Analysis/DifferentialExpression/R/vioplot2.R"</span>)</span><br><span class="line"></span><br><span class="line">data = primary_data</span><br><span class="line">myheatcol = colorpanel(<span class="number">75</span>, <span class="string">'purple'</span>,<span class="string">'black'</span>,<span class="string">'yellow'</span>)</span><br><span class="line">sample_types = colnames(data)</span><br><span class="line">nsamples = length(sample_types)</span><br><span class="line">sample_colors = rainbow(nsamples)</span><br><span class="line">sample_type_list = list()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nsamples) &#123;</span><br><span class="line">    sample_type_list[[sample_types[i]]] = sample_types[i]</span><br><span class="line">&#125;</span><br><span class="line">sample_factoring = colnames(data)</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nsamples) &#123;</span><br><span class="line">    sample_type = sample_types[i]</span><br><span class="line">    replicates_want = sample_type_list[[sample_type]]</span><br><span class="line">    sample_factoring[ colnames(data) %<span class="keyword">in</span>% replicates_want ] = sample_type</span><br><span class="line">&#125;</span><br><span class="line">initial_matrix = data <span class="comment"># store before doing various data transformations</span></span><br><span class="line">data = log2(data+<span class="number">1</span>)</span><br><span class="line">sample_factoring = colnames(data)</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nsamples) &#123;</span><br><span class="line">    sample_type = sample_types[i]</span><br><span class="line">    replicates_want = sample_type_list[[sample_type]]</span><br><span class="line">    sample_factoring[ colnames(data) %<span class="keyword">in</span>% replicates_want ] = sample_type</span><br><span class="line">&#125;</span><br><span class="line">sampleAnnotations = matrix(ncol=ncol(data),nrow=nsamples)</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nsamples) &#123;</span><br><span class="line">  sampleAnnotations[i,] = colnames(data) %<span class="keyword">in</span>% sample_type_list[[sample_types[i]]]</span><br><span class="line">&#125;</span><br><span class="line">sampleAnnotations = apply(sampleAnnotations, <span class="number">1</span>:<span class="number">2</span>, <span class="keyword">function</span>(x) as.logical(x))</span><br><span class="line">sampleAnnotations = sample_matrix_to_color_assignments(sampleAnnotations, col=sample_colors)</span><br><span class="line">rownames(sampleAnnotations) = as.vector(sample_types)</span><br><span class="line">colnames(sampleAnnotations) = colnames(data)</span><br><span class="line">data = as.matrix(data) <span class="comment"># convert to matrix</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Centering rows</span></span><br><span class="line">data = t(scale(t(data), scale=<span class="literal">F</span>))</span><br><span class="line"></span><br><span class="line">write.table(data, file=<span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered.dat"</span>, quote=<span class="literal">F</span>, sep=<span class="string">'  '</span>);</span><br><span class="line"><span class="keyword">if</span> (nrow(data) &lt; <span class="number">2</span>) &#123; <span class="keyword">stop</span>(<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**** Sorry, at least two rows are required for this matrix.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span>);&#125;</span><br><span class="line"><span class="keyword">if</span> (ncol(data) &lt; <span class="number">2</span>) &#123; <span class="keyword">stop</span>(<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**** Sorry, at least two columns are required for this matrix.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span>);&#125;</span><br><span class="line">sample_cor = cor(data, method=<span class="string">'pearson'</span>, use=<span class="string">'pairwise.complete.obs'</span>)</span><br><span class="line">write.table(sample_cor, file=<span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered.sample_cor.dat"</span>, quote=<span class="literal">F</span>, sep=<span class="string">'  '</span>)</span><br><span class="line">sample_dist = dist(t(data), method=<span class="string">'euclidean'</span>)</span><br><span class="line">hc_samples = hclust(sample_dist, method=<span class="string">'complete'</span>)</span><br><span class="line">pdf(<span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered.sample_cor_matrix.pdf"</span>)</span><br><span class="line">sample_cor_for_plot = sample_cor</span><br><span class="line">heatmap.3(sample_cor_for_plot, dendrogram=<span class="string">'both'</span>, Rowv=as.dendrogram(hc_samples), Colv=as.dendrogram(hc_samples), col = myheatcol, scale=<span class="string">'none'</span>, symm=<span class="literal">TRUE</span>, key=<span class="literal">TRUE</span>,density.info=<span class="string">'none'</span>, trace=<span class="string">'none'</span>, symkey=<span class="literal">FALSE</span>, symbreaks=<span class="literal">F</span>, margins=c(<span class="number">10</span>,<span class="number">10</span>), cexCol=<span class="number">1</span>, cexRow=<span class="number">1</span>, cex.main=<span class="number">0.75</span>, main=paste(<span class="string">"sample correlation matrix</span></span><br><span class="line"><span class="string">"</span>, <span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered"</span>) )</span><br><span class="line">dev.off()</span><br><span class="line">gene_cor = <span class="literal">NULL</span></span><br><span class="line">gene_dist = dist(data, method=<span class="string">'euclidean'</span>)</span><br><span class="line"><span class="keyword">if</span> (nrow(data) &lt;= <span class="number">1</span>) &#123; message(<span class="string">'Too few genes to generate heatmap'</span>); quit(status=<span class="number">0</span>); &#125;</span><br><span class="line">hc_genes = hclust(gene_dist, method=<span class="string">'complete'</span>)</span><br><span class="line">heatmap_data = data</span><br><span class="line">pdf(<span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered.genes_vs_samples_heatmap.pdf"</span>)</span><br><span class="line">heatmap.3(heatmap_data, dendrogram=<span class="string">'both'</span>, Rowv=as.dendrogram(hc_genes), Colv=as.dendrogram(hc_samples), col=myheatcol, scale=<span class="string">"none"</span>, density.info=<span class="string">"none"</span>, trace=<span class="string">"none"</span>, key=<span class="literal">TRUE</span>, keysize=<span class="number">1.2</span>, cexCol=<span class="number">1</span>, margins=c(<span class="number">10</span>,<span class="number">10</span>), cex.main=<span class="number">0.75</span>, main=paste(<span class="string">"samples vs. features</span></span><br><span class="line"><span class="string">"</span>, <span class="string">"diffExpr.P1e-5_C2.matrix.log2.centered"</span> ) )</span><br><span class="line">dev.off()</span><br><span class="line"><span class="comment">#save(list=ls(all=TRUE), file="diffExpr.P1e-5_C2.matrix.RData")</span></span><br></pre></td></tr></table></figure></div>
<h2 id="Test"><a class="header-anchor" href="#Test"></a>Test</h2>
<h1>edgeR(out of date)</h1>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">~/Biosoft/trinityrnaseq-Trinity-v2.8.4/Analysis/DifferentialExpression/run_DE_analysis.pl  --matrix Intest.table  --method edgeR --dispersion <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x &lt;- read.delim(<span class="string">"3.isoforms.results"</span>)</span><br><span class="line">y &lt;- estimateCommonDisp(y)</span><br><span class="line">y &lt;- DGEList(counts=<span class="number">5</span>,group=<span class="number">1</span>)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">y &lt;- estimateTagwiseDisp(y)</span><br><span class="line">y &lt;- estimateCommonDisp(y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"3.isoforms.results"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">3</span>:<span class="number">8</span>], genes=rawdata[,<span class="number">1</span>:<span class="number">2</span>])</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">8</span>,<span class="number">8</span>,<span class="number">33</span>,<span class="number">33</span>,<span class="number">51</span>,<span class="number">51</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line">write.csv(topTags(lrt)$table, file=<span class="string">"qqq"</span>)</span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line">��Դ����������ģ�� edgeR�������裺https://www.tanboyu.com/edger-users-guide.html</span><br><span class="line"><span class="comment">#####################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################################################################################</span></span><br><span class="line">��׼��</span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line"></span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"3.isoforms.results"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">2</span>:<span class="number">6</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">8</span>,<span class="number">8</span>,<span class="number">51</span>,<span class="number">51</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line"></span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"3.isoforms.results"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">5</span>:<span class="number">8</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">51</span>,<span class="number">51</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"T"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########################################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line"></span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"3.isoforms.results"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">5</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"T"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line"></span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"6.matrix"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">2</span>:<span class="number">7</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">head(rawdata)</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line">write.table(topTags(lrt), file = <span class="string">"6.txt"</span>,append =<span class="literal">FALSE</span>, quote = <span class="literal">TRUE</span>, sep = <span class="string">" "</span>,eol = <span class="string">"\n"</span>, na = <span class="string">"NA"</span>, dec = <span class="string">"."</span>,row.names = <span class="literal">TRUE</span>,col.names = <span class="literal">TRUE</span>, qmethod = c(<span class="string">"escape"</span>, <span class="string">"double"</span>),fileEncoding = <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line">10matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"Intest.table"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">2</span>:<span class="number">101</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">head(rawdata)</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">39</span>,<span class="number">40</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">43</span>,<span class="number">44</span>,<span class="number">44</span>,<span class="number">45</span>,<span class="number">45</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">47</span>,<span class="number">47</span>,<span class="number">48</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">49</span>,<span class="number">50</span>,<span class="number">50</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"N"</span>,<span class="string">"T"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line">write.table(topTags(lrt), file = <span class="string">"a40.txt"</span>,append =<span class="literal">FALSE</span>, quote = <span class="literal">TRUE</span>, sep = <span class="string">" "</span>,eol = <span class="string">"\n"</span>, na = <span class="string">"NA"</span>, dec = <span class="string">"."</span>,row.names = <span class="literal">TRUE</span>,col.names = <span class="literal">TRUE</span>, qmethod = c(<span class="string">"escape"</span>, <span class="string">"double"</span>),fileEncoding = <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################</span></span><br><span class="line">3line</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"http://bioconductor.org/biocLite.R"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"limma"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"edgeR"</span>)</span><br><span class="line">rawdata &lt;- read.delim(<span class="string">"Intest.table"</span>, check.names=<span class="literal">FALSE</span>, stringsAsFactors=<span class="literal">FALSE</span>)</span><br><span class="line">y &lt;- DGEList(counts=rawdata[,<span class="number">2</span>:<span class="number">4</span>], genes=rawdata[,<span class="number">1</span>])</span><br><span class="line">head(rawdata)</span><br><span class="line">y$samples$lib.size &lt;- colSums(y$counts)</span><br><span class="line">y &lt;- calcNormFactors(y)</span><br><span class="line">Patient &lt;- factor(c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">Tissue &lt;- factor(c(<span class="string">"N"</span>,<span class="string">"T"</span>,<span class="string">"T2"</span>))</span><br><span class="line">data.frame(Sample=colnames(y),Patient,Tissue)</span><br><span class="line">design &lt;- model.matrix(~Patient+Tissue)</span><br><span class="line">rownames(design) &lt;- colnames(y)</span><br><span class="line">y &lt;- estimateGLMCommonDisp(y, design, verbose=<span class="literal">TRUE</span>)</span><br><span class="line">y &lt;- estimateGLMTrendedDisp(y, design)</span><br><span class="line">y &lt;- estimateGLMTagwiseDisp(y, design)</span><br><span class="line">fit &lt;- glmFit(y, design)</span><br><span class="line">lrt &lt;- glmLRT(fit); topTags(lrt)</span><br><span class="line">topTags(lrt)</span><br><span class="line">write.table(topTags(lrt), file = <span class="string">"a40.txt"</span>,append =<span class="literal">FALSE</span>, quote = <span class="literal">TRUE</span>, sep = <span class="string">" "</span>,eol = <span class="string">"\n"</span>, na = <span class="string">"NA"</span>, dec = <span class="string">"."</span>,row.names = <span class="literal">TRUE</span>,col.names = <span class="literal">TRUE</span>, qmethod = c(<span class="string">"escape"</span>, <span class="string">"double"</span>),fileEncoding = <span class="string">""</span>)</span><br></pre></td></tr></table></figure></div>
<hr>
<h1>Attachment</h1>
<h2 id="heatmap-3-R"><a class="header-anchor" href="#heatmap-3-R"></a>heatmap.3.R</h2>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From: https://github.com/trinityrnaseq/trinityrnaseq/blob/master/Analysis/DifferentialExpression/R/heatmap.3.R</span></span><br><span class="line"><span class="comment">## pulled from here, and then tweaked slightly: http://www.biostars.org/p/18211/</span></span><br><span class="line"><span class="comment"># CODE</span></span><br><span class="line">heatmap.3 &lt;- <span class="keyword">function</span>(x,</span><br><span class="line">                      Rowv = <span class="literal">TRUE</span>, Colv = <span class="keyword">if</span> (symm) <span class="string">"Rowv"</span> <span class="keyword">else</span> <span class="literal">TRUE</span>,</span><br><span class="line">                      distfun = dist,</span><br><span class="line">                      hclustfun = hclust,</span><br><span class="line">                      dendrogram = c(<span class="string">"both"</span>,<span class="string">"row"</span>, <span class="string">"column"</span>, <span class="string">"none"</span>),</span><br><span class="line">                      symm = <span class="literal">FALSE</span>,</span><br><span class="line">                      scale = c(<span class="string">"none"</span>,<span class="string">"row"</span>, <span class="string">"column"</span>),</span><br><span class="line">                      na.rm = <span class="literal">TRUE</span>,</span><br><span class="line">                      revC = identical(Colv,<span class="string">"Rowv"</span>),</span><br><span class="line">                      add.expr,</span><br><span class="line">                      breaks,</span><br><span class="line">                      symbreaks = max(x &lt; <span class="number">0</span>, na.rm = <span class="literal">TRUE</span>) || scale != <span class="string">"none"</span>,</span><br><span class="line">                      col = <span class="string">"heat.colors"</span>,</span><br><span class="line">                      colsep,</span><br><span class="line">                      rowsep,</span><br><span class="line">                      sepcolor = <span class="string">"white"</span>,</span><br><span class="line">                      sepwidth = c(<span class="number">0.05</span>, <span class="number">0.05</span>),</span><br><span class="line">                      cellnote,</span><br><span class="line">                      notecex = <span class="number">1</span>,</span><br><span class="line">                      notecol = <span class="string">"cyan"</span>,</span><br><span class="line">                      na.color = par(<span class="string">"bg"</span>),</span><br><span class="line">                      trace = c(<span class="string">"none"</span>, <span class="string">"column"</span>,<span class="string">"row"</span>, <span class="string">"both"</span>),</span><br><span class="line">                      tracecol = <span class="string">"cyan"</span>,</span><br><span class="line">                      hline = median(breaks),</span><br><span class="line">                      vline = median(breaks),</span><br><span class="line">                      linecol = tracecol,</span><br><span class="line">                      margins = c(<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">                      ColSideColors,</span><br><span class="line">                      RowSideColors,</span><br><span class="line">                      side.height.fraction=<span class="number">0.1</span>,</span><br><span class="line">                      <span class="comment">#cexRow = 0.2 + 1/log10(max(nr,2)),</span></span><br><span class="line">                      <span class="comment">#cexCol = 0.2 + 1/log10(max(nc,2)),</span></span><br><span class="line">        cexRow = <span class="number">0.2</span>,</span><br><span class="line">        cexCol = <span class="number">0.2</span>,                  </span><br><span class="line"></span><br><span class="line">        scaleRangeMin,</span><br><span class="line">        scaleRangeMax,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cex.main = <span class="number">1</span>,</span><br><span class="line">                      labRow = <span class="literal">NULL</span>,</span><br><span class="line">                      labCol = <span class="literal">NULL</span>,</span><br><span class="line">                      key = <span class="literal">TRUE</span>,</span><br><span class="line">                      keysize = <span class="number">1.5</span>,</span><br><span class="line">                      density.info = c(<span class="string">"none"</span>, <span class="string">"histogram"</span>, <span class="string">"density"</span>),</span><br><span class="line">                      denscol = tracecol,</span><br><span class="line">                      symkey = max(x &lt; <span class="number">0</span>, na.rm = <span class="literal">TRUE</span>) || symbreaks,</span><br><span class="line">                      densadj = <span class="number">0.25</span>,</span><br><span class="line">                      main = <span class="literal">NULL</span>,</span><br><span class="line">                      xlab = <span class="literal">NULL</span>,</span><br><span class="line">                      ylab = <span class="literal">NULL</span>,</span><br><span class="line">                      lmat = <span class="literal">NULL</span>,</span><br><span class="line">                      lhei = <span class="literal">NULL</span>,</span><br><span class="line">                      lwid = <span class="literal">NULL</span>,</span><br><span class="line">                      NumColSideColors = <span class="number">1</span>,</span><br><span class="line">                      NumRowSideColors = <span class="number">1</span>,</span><br><span class="line">                      KeyValueName=<span class="string">"Value"</span>,<span class="keyword">...</span>)&#123;</span><br><span class="line"></span><br><span class="line">    invalid &lt;- <span class="keyword">function</span> (x) &#123;</span><br><span class="line">      <span class="keyword">if</span> (missing(x) || is.null(x) || length(x) == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">return</span>(<span class="literal">TRUE</span>)</span><br><span class="line">      <span class="keyword">if</span> (is.list(x))</span><br><span class="line">          <span class="keyword">return</span>(all(sapply(x, invalid)))</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (is.vector(x))</span><br><span class="line">          <span class="keyword">return</span>(all(is.na(x)))</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span>(<span class="literal">FALSE</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    x &lt;- as.matrix(x)</span><br><span class="line">    scale01 &lt;- <span class="keyword">function</span>(x, low = min(x), high = max(x)) &#123;</span><br><span class="line">        x &lt;- (x - low)/(high - low)</span><br><span class="line">        x</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    retval &lt;- list()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    scale &lt;- <span class="keyword">if</span> (symm &amp;&amp; missing(scale))</span><br><span class="line">        <span class="string">"none"</span></span><br><span class="line">    <span class="keyword">else</span> match.arg(scale)</span><br><span class="line"></span><br><span class="line">    dendrogram &lt;- match.arg(dendrogram)</span><br><span class="line"></span><br><span class="line">    trace &lt;- match.arg(trace)</span><br><span class="line"></span><br><span class="line">    density.info &lt;- match.arg(density.info)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length(col) == <span class="number">1</span> &amp;&amp; is.character(col))</span><br><span class="line">        col &lt;- get(col, mode = <span class="string">"function"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!missing(breaks) &amp;&amp; (scale != <span class="string">"none"</span>))</span><br><span class="line">        <span class="keyword">warning</span>(<span class="string">"Using scale=\"row\" or scale=\"column\" when breaks are"</span>,</span><br><span class="line">            <span class="string">"specified can produce unpredictable results."</span>, <span class="string">"Please consider using only one or the other."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is.null(Rowv) || is.na(Rowv))</span><br><span class="line">        Rowv &lt;- <span class="literal">FALSE</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is.null(Colv) || is.na(Colv))</span><br><span class="line">        Colv &lt;- <span class="literal">FALSE</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Colv == <span class="string">"Rowv"</span> &amp;&amp; !isTRUE(Rowv))</span><br><span class="line">        Colv &lt;- <span class="literal">FALSE</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length(di &lt;- dim(x)) != <span class="number">2</span> || !is.numeric(x))</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">"`x' must be a numeric matrix"</span>)</span><br><span class="line"></span><br><span class="line">    nr &lt;- di[<span class="number">1</span>]</span><br><span class="line">    nc &lt;- di[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nr &lt;= <span class="number">1</span> || nc &lt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">"`x' must have at least 2 rows and 2 columns"</span>)</span><br><span class="line">    <span class="comment">#print(paste("nr:", nr, "nc:", nc, "cexCol:", cexCol, "cexRow:", cexRow))</span></span><br><span class="line">    <span class="comment">#stop("debug")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!is.numeric(margins) || length(margins) != <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">"`margins' must be a numeric vector of length 2"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (missing(cellnote))</span><br><span class="line">        cellnote &lt;- matrix(<span class="string">""</span>, ncol = ncol(x), nrow = nrow(x))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!inherits(Rowv, <span class="string">"dendrogram"</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (((!isTRUE(Rowv)) || (is.null(Rowv))) &amp;&amp; (dendrogram %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"row"</span>))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is.logical(Colv) &amp;&amp; (Colv))</span><br><span class="line">                dendrogram &lt;- <span class="string">"column"</span></span><br><span class="line">            <span class="keyword">else</span> dedrogram &lt;- <span class="string">"none"</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">warning</span>(<span class="string">"Discrepancy: Rowv is FALSE, while dendrogram is `"</span>,</span><br><span class="line">                dendrogram, <span class="string">"'. Omitting row dendogram."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!inherits(Colv, <span class="string">"dendrogram"</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (((!isTRUE(Colv)) || (is.null(Colv))) &amp;&amp; (dendrogram %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"column"</span>))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is.logical(Rowv) &amp;&amp; (Rowv))</span><br><span class="line">                dendrogram &lt;- <span class="string">"row"</span></span><br><span class="line">            <span class="keyword">else</span> dendrogram &lt;- <span class="string">"none"</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">warning</span>(<span class="string">"Discrepancy: Colv is FALSE, while dendrogram is `"</span>,</span><br><span class="line">                dendrogram, <span class="string">"'. Omitting column dendogram."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (inherits(Rowv, <span class="string">"dendrogram"</span>)) &#123;</span><br><span class="line">        ddr &lt;- Rowv</span><br><span class="line">        rowInd &lt;- order.dendrogram(ddr)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is.integer(Rowv)) &#123;</span><br><span class="line">        hcr &lt;- hclustfun(distfun(x))</span><br><span class="line">        ddr &lt;- as.dendrogram(hcr)</span><br><span class="line">        ddr &lt;- reorder(ddr, Rowv)</span><br><span class="line">        rowInd &lt;- order.dendrogram(ddr)</span><br><span class="line">        <span class="keyword">if</span> (nr != length(rowInd))</span><br><span class="line">            <span class="keyword">stop</span>(<span class="string">"row dendrogram ordering gave index of wrong length"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isTRUE(Rowv)) &#123;</span><br><span class="line">        Rowv &lt;- rowMeans(x, na.rm = na.rm)</span><br><span class="line">        hcr &lt;- hclustfun(distfun(x))</span><br><span class="line">        ddr &lt;- as.dendrogram(hcr)</span><br><span class="line">        ddr &lt;- reorder(ddr, Rowv)</span><br><span class="line">        rowInd &lt;- order.dendrogram(ddr)</span><br><span class="line">        <span class="keyword">if</span> (nr != length(rowInd))</span><br><span class="line">            <span class="keyword">stop</span>(<span class="string">"row dendrogram ordering gave index of wrong length"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        rowInd &lt;- nr:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (inherits(Colv, <span class="string">"dendrogram"</span>)) &#123;</span><br><span class="line">        ddc &lt;- Colv</span><br><span class="line">        colInd &lt;- order.dendrogram(ddc)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (identical(Colv, <span class="string">"Rowv"</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nr != nc)</span><br><span class="line">            <span class="keyword">stop</span>(<span class="string">"Colv = \"Rowv\" but nrow(x) != ncol(x)"</span>)</span><br><span class="line">        <span class="keyword">if</span> (exists(<span class="string">"ddr"</span>)) &#123;</span><br><span class="line">            ddc &lt;- ddr</span><br><span class="line">            colInd &lt;- order.dendrogram(ddc)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> colInd &lt;- rowInd</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is.integer(Colv)) &#123;</span><br><span class="line">        hcc &lt;- hclustfun(distfun(<span class="keyword">if</span> (symm)</span><br><span class="line">            x</span><br><span class="line">        <span class="keyword">else</span> t(x)))</span><br><span class="line">        ddc &lt;- as.dendrogram(hcc)</span><br><span class="line">        ddc &lt;- reorder(ddc, Colv)</span><br><span class="line">        colInd &lt;- order.dendrogram(ddc)</span><br><span class="line">        <span class="keyword">if</span> (nc != length(colInd))</span><br><span class="line">            <span class="keyword">stop</span>(<span class="string">"column dendrogram ordering gave index of wrong length"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isTRUE(Colv)) &#123;</span><br><span class="line">        Colv &lt;- colMeans(x, na.rm = na.rm)</span><br><span class="line">        hcc &lt;- hclustfun(distfun(<span class="keyword">if</span> (symm)</span><br><span class="line">            x</span><br><span class="line">        <span class="keyword">else</span> t(x)))</span><br><span class="line">        ddc &lt;- as.dendrogram(hcc)</span><br><span class="line">        ddc &lt;- reorder(ddc, Colv)</span><br><span class="line">        colInd &lt;- order.dendrogram(ddc)</span><br><span class="line">        <span class="keyword">if</span> (nc != length(colInd))</span><br><span class="line">            <span class="keyword">stop</span>(<span class="string">"column dendrogram ordering gave index of wrong length"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        colInd &lt;- <span class="number">1</span>:nc</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    retval$rowInd &lt;- rowInd</span><br><span class="line">    retval$colInd &lt;- colInd</span><br><span class="line">    retval$call &lt;- match.call()</span><br><span class="line"></span><br><span class="line">    x &lt;- x[rowInd, colInd]  <span class="comment"># rearrange matrix according to dendrograms</span></span><br><span class="line">    x.unscaled &lt;- x</span><br><span class="line"></span><br><span class="line">    cellnote &lt;- cellnote[rowInd, colInd]  <span class="comment"># also rearrange the cellnotes</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># get labels</span></span><br><span class="line">    <span class="keyword">if</span> (is.null(labRow))</span><br><span class="line">        labRow &lt;- <span class="keyword">if</span> (is.null(rownames(x)))</span><br><span class="line">            (<span class="number">1</span>:nr)[rowInd]</span><br><span class="line">        <span class="keyword">else</span> rownames(x)</span><br><span class="line">    <span class="keyword">else</span> labRow &lt;- labRow[rowInd]</span><br><span class="line">    <span class="keyword">if</span> (is.null(labCol))</span><br><span class="line">        labCol &lt;- <span class="keyword">if</span> (is.null(colnames(x)))</span><br><span class="line">            (<span class="number">1</span>:nc)[colInd]</span><br><span class="line">        <span class="keyword">else</span> colnames(x)</span><br><span class="line">    <span class="keyword">else</span> labCol &lt;- labCol[colInd]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">## do scaling of matrix according to Z-scores</span></span><br><span class="line">    <span class="keyword">if</span> (scale == <span class="string">"row"</span>) &#123;</span><br><span class="line">        retval$rowMeans &lt;- rm &lt;- rowMeans(x, na.rm = na.rm)</span><br><span class="line">        x &lt;- sweep(x, <span class="number">1</span>, rm)</span><br><span class="line">        retval$rowSDs &lt;- sx &lt;- apply(x, <span class="number">1</span>, sd, na.rm = na.rm)</span><br><span class="line">        x &lt;- sweep(x, <span class="number">1</span>, sx, <span class="string">"/"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (scale == <span class="string">"column"</span>) &#123;</span><br><span class="line">        retval$colMeans &lt;- rm &lt;- colMeans(x, na.rm = na.rm)</span><br><span class="line">        x &lt;- sweep(x, <span class="number">2</span>, rm)</span><br><span class="line">        retval$colSDs &lt;- sx &lt;- apply(x, <span class="number">2</span>, sd, na.rm = na.rm)</span><br><span class="line">        x &lt;- sweep(x, <span class="number">2</span>, sx, <span class="string">"/"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># number of breaks</span></span><br><span class="line">    <span class="keyword">if</span> (missing(breaks) || is.null(breaks) || length(breaks) &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (missing(col) || is.function(col))</span><br><span class="line">            breaks &lt;- <span class="number">16</span></span><br><span class="line">        <span class="keyword">else</span> breaks &lt;- length(col) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># set breakpoints</span></span><br><span class="line">    <span class="keyword">if</span> (length(breaks) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (missing(scaleRangeMin))</span><br><span class="line">            scaleRangeMin = min(x, na.rm=na.rm)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (missing(scaleRangeMax))</span><br><span class="line">            scaleRangeMax = max(x, na.rm=na.rm)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!symbreaks) &#123;</span><br><span class="line">            breaks &lt;- seq(scaleRangeMin, scaleRangeMax, length=breaks);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">#extreme &lt;- max(abs(x), na.rm = TRUE)</span></span><br><span class="line">            extreme = max(abs(c(scaleRangeMin,scaleRangeMax)), na.rm=na.rm)</span><br><span class="line">            breaks &lt;- seq(-extreme, extreme, length = breaks)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    nbr &lt;- length(breaks)</span><br><span class="line">    ncol &lt;- length(breaks) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (class(col) == <span class="string">"function"</span>)</span><br><span class="line">        col &lt;- col(ncol)</span><br><span class="line"></span><br><span class="line">    min.breaks &lt;- min(breaks)</span><br><span class="line">    max.breaks &lt;- max(breaks)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># adjust for out-of-range given break settings</span></span><br><span class="line">    x[x &lt; min.breaks] &lt;- min.breaks</span><br><span class="line">    x[x &gt; max.breaks] &lt;- max.breaks</span><br><span class="line"></span><br><span class="line">    <span class="comment"># layout height</span></span><br><span class="line">    <span class="keyword">if</span> (missing(lhei) || is.null(lhei))</span><br><span class="line">        lhei &lt;- c(keysize, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># layout width</span></span><br><span class="line">    <span class="keyword">if</span> (missing(lwid) || is.null(lwid))</span><br><span class="line">        lwid &lt;- c(keysize, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># define the layout</span></span><br><span class="line">    <span class="keyword">if</span> (missing(lmat) || is.null(lmat)) &#123;</span><br><span class="line">        lmat &lt;- rbind(<span class="number">4</span>:<span class="number">3</span>, <span class="number">2</span>:<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!missing(ColSideColors)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!is.character(ColSideColors) || ncol(ColSideColors) != nc)</span><br><span class="line">                <span class="keyword">stop</span>(<span class="string">"'ColSideColors' must be a matrix of ncol(x) "</span>, nc, <span class="string">" columns"</span>)</span><br><span class="line">            lmat &lt;- rbind(lmat[<span class="number">1</span>, ] + <span class="number">1</span>, c(<span class="literal">NA</span>, <span class="number">1</span>), lmat[<span class="number">2</span>, ] + <span class="number">1</span>)</span><br><span class="line">            <span class="comment">#lhei=c(lhei[1], side.height.fraction*NumColSideColors, lhei[2])</span></span><br><span class="line">            side_height = min(side.height.fraction*nrow(ColSideColors), <span class="number">1</span>);</span><br><span class="line">            lhei=c(lhei[<span class="number">1</span>], side_height, lhei[<span class="number">2</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!missing(RowSideColors)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!is.character(RowSideColors) || nrow(RowSideColors) != nr)</span><br><span class="line">                <span class="keyword">stop</span>(<span class="string">"'RowSideColors' must be a matrix of nrow(x) "</span>, nr, <span class="string">" rows.  It currently has "</span>, nrow(RowSideColors), <span class="string">" rows."</span>)</span><br><span class="line">            lmat &lt;- cbind(lmat[, <span class="number">1</span>] + <span class="number">1</span>, c(rep(<span class="literal">NA</span>, nrow(lmat) - <span class="number">1</span>), <span class="number">1</span>), lmat[,<span class="number">2</span>] + <span class="number">1</span>)</span><br><span class="line">            <span class="comment">#lwid &lt;- c(lwid[1], side.height.fraction*NumRowSideColors, lwid[2])</span></span><br><span class="line">            side_width = min(side.height.fraction*ncol(RowSideColors), <span class="number">1</span>);</span><br><span class="line">      lwid &lt;- c(lwid[<span class="number">1</span>], side_width, lwid[<span class="number">2</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        lmat[is.na(lmat)] &lt;- <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length(lhei) != nrow(lmat))</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">"lhei must have length = nrow(lmat) = "</span>, nrow(lmat))</span><br><span class="line">    <span class="keyword">if</span> (length(lwid) != ncol(lmat))</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">"lwid must have length = ncol(lmat) ="</span>, ncol(lmat))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  op &lt;- par(no.readonly = <span class="literal">TRUE</span>)</span><br><span class="line">    on.exit(par(op))</span><br><span class="line"></span><br><span class="line">    layout(lmat, widths = lwid, heights = lhei, respect = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">###########################################</span></span><br><span class="line">  <span class="comment">## Draw the colorbars for the annotations:</span></span><br><span class="line">  <span class="comment">###########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!missing(RowSideColors)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!is.matrix(RowSideColors))&#123;</span><br><span class="line">                par(mar = c(margins[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>))</span><br><span class="line">                image(rbind(<span class="number">1</span>:nr), col = RowSideColors[rowInd], axes = <span class="literal">FALSE</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            par(mar = c(margins[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>))</span><br><span class="line">            rsc = t(RowSideColors[rowInd, , drop=<span class="literal">F</span>])</span><br><span class="line">            rsc.colors = matrix()</span><br><span class="line">            rsc.names = names(table(rsc))</span><br><span class="line">            rsc.i = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> (rsc.name <span class="keyword">in</span> rsc.names) &#123;</span><br><span class="line">                rsc.colors[rsc.i] = rsc.name</span><br><span class="line">                rsc[rsc == rsc.name] = rsc.i</span><br><span class="line">                rsc.i = rsc.i + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># print(rsc)</span></span><br><span class="line">            rsc = matrix(as.numeric(rsc), nrow = dim(rsc)[<span class="number">1</span>])</span><br><span class="line">            <span class="comment">#print("RSC: ", rsc)</span></span><br><span class="line">            <span class="comment">#print(rsc.colors)    </span></span><br><span class="line">            image(<span class="number">1</span>:nrow(rsc), <span class="number">1</span>:ncol(rsc), rsc, col = as.vector(rsc.colors), axes = <span class="literal">FALSE</span>, xlab=<span class="string">""</span>, ylab=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># add labels</span></span><br><span class="line">            <span class="keyword">if</span> (length(colnames(RowSideColors)) &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">                <span class="comment">#axis(1, 0:(dim(rsc)[2] - 1)/(dim(rsc)[2] - 1), rownames(RowSideColors), las = 2, tick = FALSE)</span></span><br><span class="line">        <span class="comment">#axis(1, 0:(nrow(rsc)-1), colnames(RowSideColors), las = 2, tick = T) # ncol because transposed</span></span><br><span class="line">              axis(<span class="number">1</span>, <span class="number">1</span>:ncol(RowSideColors), labels=colnames(RowSideColors), las=<span class="number">2</span>, cex.axis=<span class="number">0.5</span>, tick=<span class="literal">F</span>, xlab=<span class="string">""</span>, ylab=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!missing(ColSideColors)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is.matrix(ColSideColors))&#123;</span><br><span class="line">            par(mar = c(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>, margins[<span class="number">2</span>]))</span><br><span class="line">            image(cbind(<span class="number">1</span>:nc), col = ColSideColors[colInd], axes = <span class="literal">FALSE</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            par(mar = c(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>, margins[<span class="number">2</span>]))</span><br><span class="line">            csc = ColSideColors[, colInd, drop=<span class="literal">F</span>]</span><br><span class="line">            csc.colors = matrix()</span><br><span class="line">            csc.names = names(table(csc))</span><br><span class="line">            csc.i = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> (csc.name <span class="keyword">in</span> csc.names) &#123;</span><br><span class="line">                csc.colors[csc.i] = csc.name</span><br><span class="line">                csc[csc == csc.name] = csc.i</span><br><span class="line">                csc.i = csc.i + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            csc = matrix(as.numeric(csc), nrow = dim(csc)[<span class="number">1</span>])</span><br><span class="line">            <span class="comment">#print(csc)</span></span><br><span class="line">            image(<span class="number">1</span>:nrow(t(csc)), <span class="number">1</span>:ncol(t(csc)), t(csc), col = as.vector(csc.colors), axes = <span class="literal">FALSE</span>, xlab=<span class="string">""</span>, ylab=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># add labels</span></span><br><span class="line">            <span class="keyword">if</span> (length(rownames(ColSideColors)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">#axis(2, 0:(dim(csc)[2] - 1)/max(1,(dim(csc)[2] - 1)), colnames(ColSideColors), las = 2, tick = FALSE)</span></span><br><span class="line">        axis(<span class="number">2</span>, <span class="number">1</span>:(nrow(ColSideColors)), labels=rownames(ColSideColors), las = <span class="number">2</span>, tick = <span class="literal">FALSE</span>, cex.axis=<span class="number">0.5</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    par(mar = c(margins[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, margins[<span class="number">2</span>]))</span><br><span class="line">    x &lt;- t(x)</span><br><span class="line">    cellnote &lt;- t(cellnote)</span><br><span class="line">    <span class="keyword">if</span> (revC) &#123;</span><br><span class="line">        iy &lt;- nr:<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (exists(<span class="string">"ddr"</span>))</span><br><span class="line">            ddr &lt;- rev(ddr)</span><br><span class="line">        x &lt;- x[, iy]</span><br><span class="line">        cellnote &lt;- cellnote[, iy]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> iy &lt;- <span class="number">1</span>:nr</span><br><span class="line"></span><br><span class="line">  <span class="comment"># draw the central heatmap</span></span><br><span class="line">  image(<span class="number">1</span>:nc, <span class="number">1</span>:nr, x, xlim = <span class="number">0.5</span> + c(<span class="number">0</span>, nc), ylim = <span class="number">0.5</span> + c(<span class="number">0</span>, nr), axes = <span class="literal">FALSE</span>, xlab = <span class="string">""</span>, ylab = <span class="string">""</span>, col = col, breaks = breaks, <span class="keyword">...</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># store the matrix drawn</span></span><br><span class="line">  retval$carpet &lt;- x</span><br><span class="line"></span><br><span class="line">  <span class="comment"># store the dendrograms</span></span><br><span class="line">  <span class="keyword">if</span> (exists(<span class="string">"ddr"</span>))</span><br><span class="line">        retval$rowDendrogram &lt;- ddr</span><br><span class="line">    <span class="keyword">if</span> (exists(<span class="string">"ddc"</span>))</span><br><span class="line">        retval$colDendrogram &lt;- ddc</span><br><span class="line"></span><br><span class="line">  <span class="comment"># store the breaks</span></span><br><span class="line">  retval$breaks &lt;- breaks</span><br><span class="line"></span><br><span class="line">  <span class="comment"># store the colormap used</span></span><br><span class="line">  retval$col &lt;- col</span><br><span class="line"></span><br><span class="line">  <span class="comment"># specially color in the na values</span></span><br><span class="line">    <span class="keyword">if</span> (!invalid(na.color) &amp; any(is.na(x))) &#123; <span class="comment"># load library(gplots)</span></span><br><span class="line">        mmat &lt;- ifelse(is.na(x), <span class="number">1</span>, <span class="literal">NA</span>)</span><br><span class="line">        image(<span class="number">1</span>:nc, <span class="number">1</span>:nr, mmat, axes = <span class="literal">FALSE</span>, xlab = <span class="string">""</span>, ylab = <span class="string">""</span>, col = na.color, add = <span class="literal">TRUE</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># X-axis column labels</span></span><br><span class="line">    axis(<span class="number">1</span>, <span class="number">1</span>:nc, labels = labCol, las = <span class="number">2</span>, line = -<span class="number">0.5</span>, tick = <span class="number">0</span>, cex.axis = cexCol)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># X-axis title</span></span><br><span class="line">    <span class="keyword">if</span> (!is.null(xlab))</span><br><span class="line">        mtext(xlab, side = <span class="number">1</span>, line = margins[<span class="number">1</span>] - <span class="number">1.25</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Y-axis row labeling</span></span><br><span class="line">    axis(<span class="number">4</span>, iy, labels = labRow, las = <span class="number">2</span>, line = -<span class="number">0.5</span>, tick = <span class="number">0</span>,</span><br><span class="line">        cex.axis = cexRow)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Y-axis title</span></span><br><span class="line">    <span class="keyword">if</span> (!is.null(ylab))</span><br><span class="line">        mtext(ylab, side = <span class="number">4</span>, line = margins[<span class="number">2</span>] - <span class="number">1.25</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!missing(add.expr))</span><br><span class="line">        eval(substitute(add.expr))</span><br><span class="line">    <span class="keyword">if</span> (!missing(colsep))</span><br><span class="line">        <span class="keyword">for</span> (csep <span class="keyword">in</span> colsep) rect(xleft = csep + <span class="number">0.5</span>, ybottom = rep(<span class="number">0</span>, length(csep)), xright = csep + <span class="number">0.5</span> + sepwidth[<span class="number">1</span>], ytop = rep(ncol(x) + <span class="number">1</span>, csep), lty = <span class="number">1</span>, lwd = <span class="number">1</span>, col = sepcolor, border = sepcolor)</span><br><span class="line">    <span class="keyword">if</span> (!missing(rowsep))</span><br><span class="line">        <span class="keyword">for</span> (rsep <span class="keyword">in</span> rowsep) rect(xleft = <span class="number">0</span>, ybottom = (ncol(x) + <span class="number">1</span> - rsep) - <span class="number">0.5</span>, xright = nrow(x) + <span class="number">1</span>, ytop = (ncol(x) + <span class="number">1</span> - rsep) - <span class="number">0.5</span> - sepwidth[<span class="number">2</span>], lty = <span class="number">1</span>, lwd = <span class="number">1</span>, col = sepcolor, border = sepcolor)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  min.scale &lt;- min(breaks)</span><br><span class="line">    max.scale &lt;- max(breaks)</span><br><span class="line">    x.scaled &lt;- scale01(t(x), min.scale, max.scale)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># column trace</span></span><br><span class="line">  <span class="keyword">if</span> (trace %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"column"</span>)) &#123;</span><br><span class="line">        retval$vline &lt;- vline</span><br><span class="line">        vline.vals &lt;- scale01(vline, min.scale, max.scale)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> colInd) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!is.null(vline)) &#123;</span><br><span class="line">                abline(v = i - <span class="number">0.5</span> + vline.vals, col = linecol, lty = <span class="number">2</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            xv &lt;- rep(i, nrow(x.scaled)) + x.scaled[, i] - <span class="number">0.5</span></span><br><span class="line">            xv &lt;- c(xv[<span class="number">1</span>], xv)</span><br><span class="line">            yv &lt;- <span class="number">1</span>:length(xv) - <span class="number">0.5</span></span><br><span class="line">            lines(x = xv, y = yv, lwd = <span class="number">1</span>, col = tracecol, type = <span class="string">"s"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># row trace</span></span><br><span class="line">    <span class="keyword">if</span> (trace %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"row"</span>)) &#123;</span><br><span class="line">        retval$hline &lt;- hline</span><br><span class="line">        hline.vals &lt;- scale01(hline, min.scale, max.scale)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> rowInd) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!is.null(hline)) &#123;</span><br><span class="line">                abline(h = i + hline, col = linecol, lty = <span class="number">2</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            yv &lt;- rep(i, ncol(x.scaled)) + x.scaled[i, ] - <span class="number">0.5</span></span><br><span class="line">            yv &lt;- rev(c(yv[<span class="number">1</span>], yv))</span><br><span class="line">            xv &lt;- length(yv):<span class="number">1</span> - <span class="number">0.5</span></span><br><span class="line">            lines(x = xv, y = yv, lwd = <span class="number">1</span>, col = tracecol, type = <span class="string">"s"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># add cell labels</span></span><br><span class="line">    <span class="keyword">if</span> (!missing(cellnote))</span><br><span class="line">        text(x = c(row(cellnote)), y = c(col(cellnote)), labels = c(cellnote), col = notecol, cex = notecex)</span><br><span class="line"></span><br><span class="line">  <span class="comment">###########################</span></span><br><span class="line">  <span class="comment">## Plot the row dendrogram</span></span><br><span class="line">  <span class="comment">###########################</span></span><br><span class="line"></span><br><span class="line">    par(mar = c(margins[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">if</span> (dendrogram %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"row"</span>)) &#123;</span><br><span class="line">        plot(ddr, horiz = <span class="literal">TRUE</span>, axes = <span class="literal">FALSE</span>, yaxs = <span class="string">"i"</span>, leaflab = <span class="string">"none"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> plot.new()</span><br><span class="line"></span><br><span class="line">  <span class="comment">#############################</span></span><br><span class="line">  <span class="comment">## Plot the column dendrogram</span></span><br><span class="line">  <span class="comment">#############################</span></span><br><span class="line"></span><br><span class="line">    par(mar = c(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">if</span> (!is.null(main)) <span class="number">5</span> <span class="keyword">else</span> <span class="number">0</span>, margins[<span class="number">2</span>]))</span><br><span class="line">    <span class="keyword">if</span> (dendrogram %<span class="keyword">in</span>% c(<span class="string">"both"</span>, <span class="string">"column"</span>)) &#123;</span><br><span class="line">        plot(ddc, axes = <span class="literal">FALSE</span>, xaxs = <span class="string">"i"</span>, leaflab = <span class="string">"none"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> plot.new()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!is.null(main))</span><br><span class="line">        title(main, cex.main=cex.main) <span class="comment">#cex.main = 1.5 * op[["cex.main"]])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">############################</span></span><br><span class="line">  <span class="comment">## Add the Color Chart</span></span><br><span class="line">  <span class="comment">############################</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (key) &#123;</span><br><span class="line">        par(mar = c(<span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>), cex = <span class="number">0.75</span>)</span><br><span class="line">        tmpbreaks &lt;- breaks</span><br><span class="line">        <span class="keyword">if</span> (symkey) &#123;</span><br><span class="line">            max.raw &lt;- max(abs(c(x, breaks)), na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">            min.raw &lt;- -max.raw</span><br><span class="line">            tmpbreaks[<span class="number">1</span>] &lt;- -max(abs(x), na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">            tmpbreaks[length(tmpbreaks)] &lt;- max(abs(x), na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            min.raw &lt;- min(c(x,breaks), na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">            max.raw &lt;- max(c(x,breaks), na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        message(<span class="string">'for plotting:: min.raw: '</span>, min.raw, <span class="string">' max.raw: '</span>, max.raw);</span><br><span class="line"></span><br><span class="line">        z &lt;- seq(min.raw, max.raw, length = length(col))</span><br><span class="line">        image(z = matrix(z, ncol = <span class="number">1</span>), col = col, breaks = tmpbreaks,</span><br><span class="line">            xaxt = <span class="string">"n"</span>, yaxt = <span class="string">"n"</span>)</span><br><span class="line">        par(usr = c(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">        lv &lt;- pretty(breaks)</span><br><span class="line">        xv &lt;- scale01(as.numeric(lv), min.raw, max.raw)</span><br><span class="line">        axis(<span class="number">1</span>, at = xv, labels = lv)</span><br><span class="line">        <span class="keyword">if</span> (scale == <span class="string">"row"</span>)</span><br><span class="line">            mtext(side = <span class="number">1</span>, <span class="string">"Row Z-Score"</span>, line = <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (scale == <span class="string">"column"</span>)</span><br><span class="line">            mtext(side = <span class="number">1</span>, <span class="string">"Column Z-Score"</span>, line = <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">else</span> mtext(side = <span class="number">1</span>, KeyValueName, line = <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> (density.info == <span class="string">"density"</span>) &#123;</span><br><span class="line">            dens &lt;- density(x, adjust = densadj, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">            omit &lt;- dens$x &lt; min(breaks) | dens$x &gt; max(breaks)</span><br><span class="line">            dens$x &lt;- dens$x[-omit]</span><br><span class="line">            dens$y &lt;- dens$y[-omit]</span><br><span class="line">            dens$x &lt;- scale01(dens$x, min.raw, max.raw)</span><br><span class="line">            lines(dens$x, dens$y/max(dens$y) * <span class="number">0.95</span>, col = denscol,</span><br><span class="line">                lwd = <span class="number">1</span>)</span><br><span class="line">            axis(<span class="number">2</span>, at = pretty(dens$y)/max(dens$y) * <span class="number">0.95</span>, pretty(dens$y))</span><br><span class="line">            title(<span class="string">"Color Key\nand Density Plot"</span>)</span><br><span class="line">            par(cex = <span class="number">0.5</span>)</span><br><span class="line">            mtext(side = <span class="number">2</span>, <span class="string">"Density"</span>, line = <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (density.info == <span class="string">"histogram"</span>) &#123;</span><br><span class="line">            h &lt;- hist(x, plot = <span class="literal">FALSE</span>, breaks = breaks)</span><br><span class="line">            hx &lt;- scale01(breaks, min.raw, max.raw)</span><br><span class="line">            hy &lt;- c(h$counts, h$counts[length(h$counts)])</span><br><span class="line">            lines(hx, hy/max(hy) * <span class="number">0.95</span>, lwd = <span class="number">1</span>, type = <span class="string">"s"</span>,</span><br><span class="line">                col = denscol)</span><br><span class="line">            axis(<span class="number">2</span>, at = pretty(hy)/max(hy) * <span class="number">0.95</span>, pretty(hy))</span><br><span class="line">            title(<span class="string">"Color Key\nand Histogram"</span>)</span><br><span class="line">            par(cex = <span class="number">0.5</span>)</span><br><span class="line">            mtext(side = <span class="number">2</span>, <span class="string">"Count"</span>, line = <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> title(<span class="string">"Color Key"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> plot.new()</span><br><span class="line"></span><br><span class="line">    retval$colorTable &lt;- data.frame(low = retval$breaks[-length(retval$breaks)], high = retval$breaks[-<span class="number">1</span>], color = retval$col)</span><br><span class="line"></span><br><span class="line">    invisible(retval)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXAMPLE USAGE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># example of colsidecolors rowsidecolors (single column, single row)</span></span><br><span class="line"><span class="comment">#mat &lt;- matrix(1:100, byrow=T, nrow=10)</span></span><br><span class="line"><span class="comment">#column_annotation &lt;- sample(c("red", "blue", "green"), 10, replace=T)</span></span><br><span class="line"><span class="comment">#column_annotation &lt;- as.matrix(column_annotation)</span></span><br><span class="line"><span class="comment">#colnames(column_annotation) &lt;- c("Variable X")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#row_annotation &lt;- sample(c("red", "blue", "green"), 10, replace=T)</span></span><br><span class="line"><span class="comment">#row_annotation &lt;- as.matrix(t(row_annotation))</span></span><br><span class="line"><span class="comment">#rownames(row_annotation) &lt;- c("Variable Y")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#heatmap.3(mat, RowSideColors=row_annotation, ColSideColors=column_annotation)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># multiple column and row</span></span><br><span class="line"><span class="comment">#mat &lt;- matrix(1:100, byrow=T, nrow=10)</span></span><br><span class="line"><span class="comment">#column_annotation &lt;- matrix(sample(c("red", "blue", "green"), 20, replace=T), ncol=2)</span></span><br><span class="line"><span class="comment">#colnames(column_annotation) &lt;- c("Variable X1", "Variable X2")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#row_annotation &lt;- matrix(sample(c("red", "blue", "green"), 20, replace=T), nrow=2)</span></span><br><span class="line"><span class="comment">#rownames(row_annotation) &lt;- c("Variable Y1", "Variable Y2")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#heatmap.3(mat, RowSideColors=row_annotation, ColSideColors=column_annotation)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borrowing the following from gplots  (gplots isn't compatible with R 3.0 (yet), and so bypassing it for now).</span></span><br><span class="line"></span><br><span class="line">colorpanel = <span class="keyword">function</span> (n, low, mid, high)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (missing(mid) || missing(high)) &#123;</span><br><span class="line">        low &lt;- col2rgb(low)</span><br><span class="line">        <span class="keyword">if</span> (missing(high))</span><br><span class="line">            high &lt;- col2rgb(mid)</span><br><span class="line">        <span class="keyword">else</span> high &lt;- col2rgb(high)</span><br><span class="line">        red &lt;- seq(low[<span class="number">1</span>, <span class="number">1</span>], high[<span class="number">1</span>, <span class="number">1</span>], length = n)/<span class="number">255</span></span><br><span class="line">        green &lt;- seq(low[<span class="number">3</span>, <span class="number">1</span>], high[<span class="number">3</span>, <span class="number">1</span>], length = n)/<span class="number">255</span></span><br><span class="line">        blue &lt;- seq(low[<span class="number">2</span>, <span class="number">1</span>], high[<span class="number">2</span>, <span class="number">1</span>], length = n)/<span class="number">255</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        isodd &lt;- odd(n)</span><br><span class="line">        <span class="keyword">if</span> (isodd) &#123;</span><br><span class="line">            n &lt;- n + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        low &lt;- col2rgb(low)</span><br><span class="line">        mid &lt;- col2rgb(mid)</span><br><span class="line">        high &lt;- col2rgb(high)</span><br><span class="line">        lower &lt;- floor(n/<span class="number">2</span>)</span><br><span class="line">        upper &lt;- n - lower</span><br><span class="line">        red &lt;- c(seq(low[<span class="number">1</span>, <span class="number">1</span>], mid[<span class="number">1</span>, <span class="number">1</span>], length = lower), seq(mid[<span class="number">1</span>,</span><br><span class="line">            <span class="number">1</span>], high[<span class="number">1</span>, <span class="number">1</span>], length = upper))/<span class="number">255</span></span><br><span class="line">        green &lt;- c(seq(low[<span class="number">3</span>, <span class="number">1</span>], mid[<span class="number">3</span>, <span class="number">1</span>], length = lower),</span><br><span class="line">            seq(mid[<span class="number">3</span>, <span class="number">1</span>], high[<span class="number">3</span>, <span class="number">1</span>], length = upper))/<span class="number">255</span></span><br><span class="line">        blue &lt;- c(seq(low[<span class="number">2</span>, <span class="number">1</span>], mid[<span class="number">2</span>, <span class="number">1</span>], length = lower),</span><br><span class="line">            seq(mid[<span class="number">2</span>, <span class="number">1</span>], high[<span class="number">2</span>, <span class="number">1</span>], length = upper))/<span class="number">255</span></span><br><span class="line">        <span class="keyword">if</span> (isodd) &#123;</span><br><span class="line">            red &lt;- red[-(lower + <span class="number">1</span>)]</span><br><span class="line">            green &lt;- green[-(lower + <span class="number">1</span>)]</span><br><span class="line">            blue &lt;- blue[-(lower + <span class="number">1</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    rgb(red, blue, green)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">greenred = <span class="keyword">function</span> (n)  &#123;</span><br><span class="line">    colorpanel(n, <span class="string">"green"</span>, <span class="string">"black"</span>, <span class="string">"red"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">odd = <span class="keyword">function</span> (x) &#123;</span><br><span class="line">    x%%<span class="number">2</span> == <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">even = <span class="keyword">function</span> (x) &#123;</span><br><span class="line">    x%%<span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="misc-rnaseq-funcs-R"><a class="header-anchor" href="#misc-rnaseq-funcs-R"></a>misc_rnaseq_funcs.R</h2>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from https://github.com/trinityrnaseq/trinityrnaseq/blob/master/Analysis/DifferentialExpression/R/misc_rnaseq_funcs.R</span></span><br><span class="line"></span><br><span class="line">plot_counts_matrix_log2_dist = <span class="keyword">function</span>(matrix_file) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  data = read.table(file=matrix_file, com=<span class="string">''</span>, row.names=<span class="number">1</span>, header=<span class="literal">T</span>)</span><br><span class="line"></span><br><span class="line">  conditions = colnames(data)</span><br><span class="line">  colors = rainbow(length(conditions))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  plot(density(log2(data[,<span class="number">1</span>])), col=colors[<span class="number">1</span>], main=matrix_file, xlab=<span class="string">'log2(frag_counts)'</span>, ylab=<span class="string">'density'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">2</span>:length(data[<span class="number">1</span>,])) &#123;</span><br><span class="line"></span><br><span class="line">    points(density(log2(data[,i])), type=<span class="string">'l'</span>, col=colors[i])</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  legend(<span class="string">'topright'</span>, conditions, col=colors, pch=<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">matrix_to_color_assignments = <span class="keyword">function</span>(matrix_m, col=<span class="literal">NULL</span>, by=c(<span class="string">"matrix"</span>, <span class="string">"row"</span>, <span class="string">"col"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (! is.matrix(matrix_m))</span><br><span class="line">    <span class="keyword">stop</span>(<span class="string">"Error, matrix_to_color_assignments() requires a matrix as parameter."</span>)</span><br><span class="line">  num_colors = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is.null(col)) &#123;</span><br><span class="line">        num_colors = min(nrow(matrix_m), ncol(matrix_m))</span><br><span class="line">        col = rainbow(num_colors)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        num_colors = length(col)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    by = match.arg(by)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (by == <span class="string">"matrix"</span>) &#123;</span><br><span class="line"></span><br><span class="line">        min_val = min(matrix_m, na.rm=<span class="literal">T</span>)</span><br><span class="line">      matrix_m = matrix_m - min_val</span><br><span class="line">      max_val = max(matrix_m, na.rm=<span class="literal">T</span>)</span><br><span class="line">      matrix_m = matrix_m / max_val * num_colors</span><br><span class="line">        <span class="comment">#print(matrix_m)</span></span><br><span class="line">         matrix_m = apply(matrix_m, <span class="number">1</span>:<span class="number">2</span>, <span class="keyword">function</span>(x) ifelse (x&lt;<span class="number">1</span>, as.character(col[<span class="number">1</span>]), as.character(col[x])));</span><br><span class="line"></span><br><span class="line">        matrix_m = matrix(as.character(matrix_m), nrow=dim(matrix_m)[<span class="number">1</span>])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    row_or_col_only_color_selector_func = <span class="keyword">function</span>(x) &#123;</span><br><span class="line">        a = min(x, na.rm=<span class="literal">T</span>);</span><br><span class="line">        b = max(x, na.rm=<span class="literal">T</span>);</span><br><span class="line">        c = (x-a)/(b-a) * num_colors;</span><br><span class="line">                c = round(c);</span><br><span class="line">        c = ifelse (c&lt;<span class="number">1</span>, <span class="number">1</span>, c);</span><br><span class="line">                <span class="comment">#print(paste(c("color selection: (a)", a, " (b)", b, " (c)", paste(c, sep=','))));</span></span><br><span class="line">                colors = as.character(col[c]);</span><br><span class="line">                <span class="keyword">return</span>(colors);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (by == <span class="string">"row"</span>) &#123;</span><br><span class="line">            matrix_m = apply(matrix_m, <span class="number">1</span>, row_or_col_only_color_selector_func);</span><br><span class="line">            print(matrix_m)</span><br><span class="line">            print(<span class="string">"dim matrix_m after apply"</span>); print(dim(matrix_m))</span><br><span class="line">            matrix_m = t(matrix_m);</span><br><span class="line">            print(<span class="string">"dim matrix_m after transpose: "</span>); print(dim(matrix_m))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment"># by column</span></span><br><span class="line">      matrix_m = apply(matrix_m, <span class="number">2</span>, row_or_col_only_color_selector_func);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#print(matrix_m)</span></span><br><span class="line">  <span class="keyword">return</span>(matrix_m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sample_matrix_to_color_assignments = <span class="keyword">function</span>(sampleAnnotationsMatrix, colors) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (missing(colors))</span><br><span class="line">    colors = rainbow(nrow(sampleAnnotationsMatrix))</span><br><span class="line"></span><br><span class="line">  nsamples = nrow(sampleAnnotationsMatrix);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (length(colors) &lt; nrow(sampleAnnotationsMatrix))</span><br><span class="line">    <span class="keyword">stop</span>(<span class="string">"Error, only "</span>, length(colors), <span class="string">" colors specified, but have "</span>, nsamples, <span class="string">" samples"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nrow(sampleAnnotationsMatrix)) &#123;</span><br><span class="line">    c = colors[i]</span><br><span class="line">    sampleAnnotationsMatrix[i,] = sapply(sampleAnnotationsMatrix[i,], <span class="keyword">function</span>(x) ifelse( x, as.character(c), <span class="string">'white'</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>(sampleAnnotationsMatrix);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="pairs3-R"><a class="header-anchor" href="#pairs3-R"></a>pairs3.R</h2>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from: https://github.com/trinityrnaseq/trinityrnaseq/blob/master/Analysis/DifferentialExpression/R/pairs3.R</span></span><br><span class="line"><span class="comment">## snagged from: http://stackoverflow.com/questions/9680783/how-can-i-change-the-axis-position-for-pairs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modified to include function for modifying X/Y values.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pairs3 &lt;-</span><br><span class="line">  <span class="keyword">function</span> (x, labels, XY_convert_fun = <span class="literal">NULL</span>, CustomColorFun = <span class="literal">NULL</span>, panel = points, <span class="keyword">...</span>, lower.panel = panel,</span><br><span class="line">            upper.panel = panel, diag.panel = <span class="literal">NULL</span>, text.panel = textPanel,</span><br><span class="line">            label.pos = <span class="number">0.5</span> + has.diag/<span class="number">3</span>, cex.labels = <span class="literal">NULL</span>, font.labels = <span class="number">1</span>,</span><br><span class="line">            row1attop = <span class="literal">TRUE</span>, gap = <span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    textPanel &lt;- <span class="keyword">function</span>(x = <span class="number">0.5</span>, y = <span class="number">0.5</span>, txt, cex, font) text(x,</span><br><span class="line">                                                                 y, txt, cex = cex, font = font)</span><br><span class="line">    localAxis &lt;- <span class="keyword">function</span>(side, x, y, xpd, bg, col = <span class="literal">NULL</span>, main,</span><br><span class="line">                          oma, <span class="keyword">...</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (side%%<span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line">        Axis(x, side = side, xpd = <span class="literal">NA</span>, <span class="keyword">...</span>)</span><br><span class="line">      <span class="keyword">else</span> Axis(y, side = side, xpd = <span class="literal">NA</span>, <span class="keyword">...</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    localPlot &lt;- <span class="keyword">function</span>(<span class="keyword">...</span>, main, oma, font.main, cex.main) &#123;</span><br><span class="line">        plot(<span class="keyword">...</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    localLowerPanel &lt;- <span class="keyword">function</span>(<span class="keyword">...</span>, main, oma, font.main, cex.main) lower.panel(<span class="keyword">...</span>)</span><br><span class="line">    localUpperPanel &lt;- <span class="keyword">function</span>(<span class="keyword">...</span>, main, oma, font.main, cex.main) upper.panel(<span class="keyword">...</span>)</span><br><span class="line">    localDiagPanel &lt;- <span class="keyword">function</span>(<span class="keyword">...</span>, main, oma, font.main, cex.main) diag.panel(<span class="keyword">...</span>)</span><br><span class="line">    dots &lt;- list(<span class="keyword">...</span>)</span><br><span class="line">    nmdots &lt;- names(dots)</span><br><span class="line">    <span class="keyword">if</span> (!is.matrix(x)) &#123;</span><br><span class="line">      x &lt;- as.data.frame(x)</span><br><span class="line">      <span class="keyword">for</span> (i <span class="keyword">in</span> seq_along(names(x))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is.factor(x[[i]]) || is.logical(x[[i]]))</span><br><span class="line">          x[[i]] &lt;- as.numeric(x[[i]])</span><br><span class="line">        <span class="keyword">if</span> (!is.numeric(unclass(x[[i]])))</span><br><span class="line">          <span class="keyword">stop</span>(<span class="string">"non-numeric argument to 'pairs'"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!is.numeric(x))</span><br><span class="line">      <span class="keyword">stop</span>(<span class="string">"non-numeric argument to 'pairs'"</span>)</span><br><span class="line">    panel &lt;- match.fun(panel)</span><br><span class="line">    <span class="keyword">if</span> ((has.lower &lt;- !is.null(lower.panel)) &amp;&amp; !missing(lower.panel))</span><br><span class="line">      lower.panel &lt;- match.fun(lower.panel)</span><br><span class="line">    <span class="keyword">if</span> ((has.upper &lt;- !is.null(upper.panel)) &amp;&amp; !missing(upper.panel))</span><br><span class="line">      upper.panel &lt;- match.fun(upper.panel)</span><br><span class="line">    <span class="keyword">if</span> ((has.diag &lt;- !is.null(diag.panel)) &amp;&amp; !missing(diag.panel))</span><br><span class="line">      diag.panel &lt;- match.fun(diag.panel)</span><br><span class="line">    <span class="keyword">if</span> (row1attop) &#123;</span><br><span class="line">      tmp &lt;- lower.panel</span><br><span class="line">      lower.panel &lt;- upper.panel</span><br><span class="line">      upper.panel &lt;- tmp</span><br><span class="line">      tmp &lt;- has.lower</span><br><span class="line">      has.lower &lt;- has.upper</span><br><span class="line">      has.upper &lt;- tmp</span><br><span class="line">    &#125;</span><br><span class="line">    nc &lt;- ncol(x)</span><br><span class="line">    <span class="keyword">if</span> (nc &lt; <span class="number">2</span>)</span><br><span class="line">      <span class="keyword">stop</span>(<span class="string">"only one column in the argument to 'pairs'"</span>)</span><br><span class="line">    has.labs &lt;- <span class="literal">TRUE</span></span><br><span class="line">    <span class="keyword">if</span> (missing(labels)) &#123;</span><br><span class="line">      labels &lt;- colnames(x)</span><br><span class="line">      <span class="keyword">if</span> (is.null(labels))</span><br><span class="line">        labels &lt;- paste(<span class="string">"var"</span>, <span class="number">1L</span>:nc)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (is.null(labels))</span><br><span class="line">      has.labs &lt;- <span class="literal">FALSE</span></span><br><span class="line">    oma &lt;- <span class="keyword">if</span> (<span class="string">"oma"</span> %<span class="keyword">in</span>% nmdots)</span><br><span class="line">      dots$oma</span><br><span class="line">    <span class="keyword">else</span> <span class="literal">NULL</span></span><br><span class="line">    main &lt;- <span class="keyword">if</span> (<span class="string">"main"</span> %<span class="keyword">in</span>% nmdots)</span><br><span class="line">      dots$main</span><br><span class="line">    <span class="keyword">else</span> <span class="literal">NULL</span></span><br><span class="line">    <span class="keyword">if</span> (is.null(oma)) &#123;</span><br><span class="line">      oma &lt;- c(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">      <span class="keyword">if</span> (!is.null(main))</span><br><span class="line">        oma[<span class="number">3L</span>] &lt;- <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line">    opar &lt;- par(mfrow = c(nc, nc), mar = rep.int(gap/<span class="number">2</span>, <span class="number">4</span>), oma = oma)</span><br><span class="line">    on.exit(par(opar))</span><br><span class="line">    dev.hold()</span><br><span class="line">    on.exit(dev.flush(), add = <span class="literal">TRUE</span>)</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="keyword">if</span> (row1attop)</span><br><span class="line">      <span class="number">1L</span>:nc</span><br><span class="line">         <span class="keyword">else</span> nc:<span class="number">1L</span>) <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1L</span>:nc) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">#print(paste(i,"vs", j));</span></span><br><span class="line">      xvals = x[,j]</span><br><span class="line">      yvals = x[,i]      </span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( (i != j) &amp;&amp; ! is.null(XY_convert_fun)) &#123;</span><br><span class="line"></span><br><span class="line">        res = XY_convert_fun(xvals, yvals);</span><br><span class="line">        xvals = res[[<span class="string">'x'</span>]]</span><br><span class="line">        yvals = res[[<span class="string">'y'</span>]]</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">            col=<span class="string">'black'</span> <span class="comment"># default</span></span><br><span class="line">            <span class="keyword">if</span> (! is.null(CustomColorFun))</span><br><span class="line">                col=CustomColorFun(xvals,yvals)</span><br><span class="line"></span><br><span class="line">       <span class="comment">#     get_list_from_ellipsis2 &lt;- function(...) as.list(substitute(list(...)))[-1L]</span></span><br><span class="line">       <span class="comment"># print(get_list_from_ellipsis2(...));stop();</span></span><br><span class="line"></span><br><span class="line">           localPlot(xvals, yvals, xlab = <span class="string">""</span>, ylab = <span class="string">""</span>,axes = <span class="literal">F</span>, <span class="comment">#col=ifelse(abs(xvals-yvals)&gt;2, 'red', 'black'),</span></span><br><span class="line">                     type = <span class="string">"n"</span>, <span class="keyword">...</span>)</span><br><span class="line">           <span class="keyword">if</span> (i == j || (i &lt; j &amp;&amp; has.lower) || (i &gt; j &amp;&amp; has.upper)) &#123;</span><br><span class="line">             box()</span><br><span class="line">             <span class="comment"># edited here...</span></span><br><span class="line">             <span class="comment">#           if (i == 1 &amp;&amp; (!(j%%2) || !has.upper || !has.lower))</span></span><br><span class="line">             <span class="comment">#           localAxis(1 + 2 * row1attop, x[, j], x[, i],</span></span><br><span class="line">             <span class="comment">#                       ...)</span></span><br><span class="line">             <span class="comment"># draw x-axis</span></span><br><span class="line">             <span class="keyword">if</span> (i != j) <span class="comment">#(i == nc &amp; j != nc)</span></span><br><span class="line">               localAxis(<span class="number">1</span>, xvals, yvals,</span><br><span class="line">                         <span class="keyword">...</span>)</span><br><span class="line">             <span class="comment"># draw y-axis</span></span><br><span class="line">             <span class="keyword">if</span> (j != i) <span class="comment">#(j == 1 &amp; i != 1)</span></span><br><span class="line">               localAxis(<span class="number">2</span>, xvals, yvals, <span class="keyword">...</span>)</span><br><span class="line">             <span class="comment">#           if (j == nc &amp;&amp; (i%%2 || !has.upper || !has.lower))</span></span><br><span class="line">             <span class="comment">#             localAxis(4, x[, j], x[, i], ...)</span></span><br><span class="line">             mfg &lt;- par(<span class="string">"mfg"</span>)</span><br><span class="line">             <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">               <span class="keyword">if</span> (has.diag)</span><br><span class="line">                 localDiagPanel(as.vector(yvals), <span class="keyword">...</span>)</span><br><span class="line">               <span class="keyword">if</span> (has.labs) &#123;</span><br><span class="line">                 par(usr = c(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">                 <span class="keyword">if</span> (is.null(cex.labels)) &#123;</span><br><span class="line">                   l.wid &lt;- strwidth(labels, <span class="string">"user"</span>)</span><br><span class="line">                   cex.labels &lt;- max(<span class="number">0.8</span>, min(<span class="number">2</span>, <span class="number">0.9</span>/max(l.wid)))</span><br><span class="line">                 &#125;</span><br><span class="line">                 text.panel(<span class="number">0.5</span>, label.pos, labels[i], cex = cex.labels,</span><br><span class="line">                            font = font.labels)</span><br><span class="line">               &#125;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; j)</span><br><span class="line">               localLowerPanel(as.vector(xvals), as.vector(yvals), col=col, <span class="keyword">...</span>)</span><br><span class="line">             <span class="keyword">else</span> localUpperPanel(as.vector(xvals), as.vector(yvals), col=col, <span class="keyword">...</span>)</span><br><span class="line">             <span class="keyword">if</span> (any(par(<span class="string">"mfg"</span>) != mfg))</span><br><span class="line">               <span class="keyword">stop</span>(<span class="string">"the 'panel' function made a new plot"</span>)</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span> par(new = <span class="literal">FALSE</span>)</span><br><span class="line">         &#125;</span><br><span class="line">    <span class="keyword">if</span> (!is.null(main)) &#123;</span><br><span class="line">      font.main &lt;- <span class="keyword">if</span> (<span class="string">"font.main"</span> %<span class="keyword">in</span>% nmdots)</span><br><span class="line">        dots$font.main</span><br><span class="line">      <span class="keyword">else</span> par(<span class="string">"font.main"</span>)</span><br><span class="line">      cex.main &lt;- <span class="keyword">if</span> (<span class="string">"cex.main"</span> %<span class="keyword">in</span>% nmdots)</span><br><span class="line">        dots$cex.main</span><br><span class="line">      <span class="keyword">else</span> par(<span class="string">"cex.main"</span>)</span><br><span class="line">      mtext(main, <span class="number">3</span>, <span class="number">3</span>, <span class="literal">TRUE</span>, <span class="number">0.5</span>, cex = cex.main, font = font.main)</span><br><span class="line">    &#125;</span><br><span class="line">    invisible(<span class="literal">NULL</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Demo it:</span></span><br><span class="line">demo_pairs3 = <span class="keyword">function</span> (custom_fun=<span class="literal">F</span>) &#123;</span><br><span class="line">    data(iris)</span><br><span class="line"></span><br><span class="line">  xy_conv = <span class="keyword">function</span>(x,y) &#123;</span><br><span class="line"></span><br><span class="line">    res = list();</span><br><span class="line">    res[[<span class="string">'x'</span>]] = (x+y)/<span class="number">2</span>;</span><br><span class="line">    res[[<span class="string">'y'</span>]] = x - y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(res);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (custom_fun) &#123;</span><br><span class="line">    pairs3(iris[<span class="number">1</span>:<span class="number">4</span>], XY_convert_fun = xy_conv, main = <span class="string">"Anderson's Iris Data -- 3 species"</span>,pch = <span class="number">21</span>, bg = c(<span class="string">"red"</span>, <span class="string">"green3"</span>, <span class="string">"blue"</span>)[unclass(iris$Species)])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    pairs3(iris[<span class="number">1</span>:<span class="number">4</span>], main = <span class="string">"Anderson's Iris Data -- 3 species"</span>,pch = <span class="number">21</span>, bg = c(<span class="string">"red"</span>, <span class="string">"green3"</span>, <span class="string">"blue"</span>)[unclass(iris$Species)])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="vioplot2-R"><a class="header-anchor" href="#vioplot2-R"></a>vioplot2.R</h2>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="R"><figure class="iseeu highlight /r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from: https://github.com/trinityrnaseq/trinityrnaseq/blob/master/Analysis/DifferentialExpression/R/vioplot2.R</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################################</span></span><br><span class="line"><span class="comment">## From:  https://stackoverflow.com/questions/22410606/violin-plot-with-list-input</span></span><br><span class="line"><span class="comment">## and slightly modified to my liking here.</span></span><br><span class="line"></span><br><span class="line">vioplot2&lt;-<span class="keyword">function</span> (x, <span class="keyword">...</span>, range = <span class="number">1.5</span>, h = <span class="literal">NULL</span>, ylim = <span class="literal">NULL</span>, names = <span class="literal">NULL</span>,</span><br><span class="line">                    horizontal = <span class="literal">FALSE</span>, col = c(<span class="string">"magenta"</span>), border = <span class="string">"black"</span>, lty = <span class="number">1</span>,</span><br><span class="line">                    lwd = <span class="number">1</span>, rectCol = <span class="string">"black"</span>, colMed = <span class="string">"white"</span>, pchMed = <span class="number">19</span>,</span><br><span class="line">                    at, add = <span class="literal">FALSE</span>, wex = <span class="number">1</span>, drawRect = <span class="literal">TRUE</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">library</span>(sm)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!is.list(x))&#123;</span><br><span class="line">        datas &lt;- list(x, <span class="keyword">...</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        datas&lt;-x</span><br><span class="line">    &#125;</span><br><span class="line">    n &lt;- length(datas)</span><br><span class="line">    <span class="keyword">if</span> (missing(at))</span><br><span class="line">        at &lt;- <span class="number">1</span>:n</span><br><span class="line">    upper &lt;- vector(mode = <span class="string">"numeric"</span>, length = n)</span><br><span class="line">    lower &lt;- vector(mode = <span class="string">"numeric"</span>, length = n)</span><br><span class="line">    q1 &lt;- vector(mode = <span class="string">"numeric"</span>, length = n)</span><br><span class="line">    q3 &lt;- vector(mode = <span class="string">"numeric"</span>, length = n)</span><br><span class="line">    med &lt;- vector(mode = <span class="string">"numeric"</span>, length = n)</span><br><span class="line">    base &lt;- vector(mode = <span class="string">"list"</span>, length = n)</span><br><span class="line">    height &lt;- vector(mode = <span class="string">"list"</span>, length = n)</span><br><span class="line">    baserange &lt;- c(<span class="literal">Inf</span>, -<span class="literal">Inf</span>)</span><br><span class="line">    args &lt;- list(display = <span class="string">"none"</span>)</span><br><span class="line">    <span class="keyword">if</span> (!(is.null(h)))</span><br><span class="line">        args &lt;- c(args, h = h)</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:n) &#123;</span><br><span class="line">        data &lt;- datas[[i]]</span><br><span class="line">        data.min &lt;- min(data)</span><br><span class="line">        data.max &lt;- max(data)</span><br><span class="line">        q1[i] &lt;- quantile(data, <span class="number">0.25</span>)</span><br><span class="line">        q3[i] &lt;- quantile(data, <span class="number">0.75</span>)</span><br><span class="line">        med[i] &lt;- median(data)</span><br><span class="line">        iqd &lt;- q3[i] - q1[i]</span><br><span class="line">        upper[i] &lt;- min(q3[i] + range * iqd, data.max)</span><br><span class="line">        lower[i] &lt;- max(q1[i] - range * iqd, data.min)</span><br><span class="line">        est.xlim &lt;- c(min(lower[i], data.min), max(upper[i],</span><br><span class="line">                                                   data.max))</span><br><span class="line">        smout &lt;- do.call(<span class="string">"sm.density"</span>, c(list(data, xlim = est.xlim),</span><br><span class="line">                                         args))</span><br><span class="line">        hscale &lt;- <span class="number">0.4</span>/max(smout$estimate) * wex</span><br><span class="line">        base[[i]] &lt;- smout$eval.points</span><br><span class="line">        height[[i]] &lt;- smout$estimate * hscale</span><br><span class="line">        t &lt;- range(base[[i]])</span><br><span class="line">        baserange[<span class="number">1</span>] &lt;- min(baserange[<span class="number">1</span>], t[<span class="number">1</span>])</span><br><span class="line">        baserange[<span class="number">2</span>] &lt;- max(baserange[<span class="number">2</span>], t[<span class="number">2</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!add) &#123;</span><br><span class="line">        xlim &lt;- <span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">                    at + c(-<span class="number">0.5</span>, <span class="number">0.5</span>)</span><br><span class="line">                <span class="keyword">else</span> range(at) + min(diff(at))/<span class="number">2</span> * c(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (is.null(ylim)) &#123;</span><br><span class="line">            ylim &lt;- baserange</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (is.null(names)) &#123;</span><br><span class="line">        label &lt;- <span class="number">1</span>:n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        label &lt;- names</span><br><span class="line">    &#125;</span><br><span class="line">    boxwidth &lt;- <span class="number">0.05</span> * wex</span><br><span class="line">    <span class="keyword">if</span> (!add)</span><br><span class="line">        plot.new()</span><br><span class="line">    <span class="keyword">if</span> (!horizontal) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!add) &#123;</span><br><span class="line">            plot.window(xlim = xlim, ylim = ylim)</span><br><span class="line">            axis(<span class="number">2</span>)</span><br><span class="line">            axis(<span class="number">1</span>, at = at, label = label)</span><br><span class="line">        &#125;</span><br><span class="line">        box()</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:n) &#123;</span><br><span class="line">            polygon(c(at[i] - height[[i]], rev(at[i] + height[[i]])),</span><br><span class="line">                    c(base[[i]], rev(base[[i]])), col = col[i], border = border,</span><br><span class="line">                    lty = lty, lwd = lwd)</span><br><span class="line">            <span class="keyword">if</span> (drawRect) &#123;</span><br><span class="line">                lines(at[c(i, i)], c(lower[i], upper[i]), lwd = lwd,</span><br><span class="line">                      lty = lty)</span><br><span class="line">                rect(at[i] - boxwidth/<span class="number">2</span>, q1[i], at[i] + boxwidth/<span class="number">2</span>,</span><br><span class="line">                     q3[i], col = rectCol)</span><br><span class="line">                points(at[i], med[i], pch = pchMed, col = colMed)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!add) &#123;</span><br><span class="line">            plot.window(xlim = ylim, ylim = xlim)</span><br><span class="line">            axis(<span class="number">1</span>)</span><br><span class="line">            axis(<span class="number">2</span>, at = at, label = label)</span><br><span class="line">        &#125;</span><br><span class="line">        box()</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:n) &#123;</span><br><span class="line">            polygon(c(base[[i]], rev(base[[i]])), c(at[i] - height[[i]],</span><br><span class="line">                                                    rev(at[i] + height[[i]])), col = col[i], border = border,</span><br><span class="line">                    lty = lty, lwd = lwd)</span><br><span class="line">            <span class="keyword">if</span> (drawRect) &#123;</span><br><span class="line">                lines(c(lower[i], upper[i]), at[c(i, i)], lwd = lwd,</span><br><span class="line">                      lty = lty)</span><br><span class="line">                rect(q1[i], at[i] - boxwidth/<span class="number">2</span>, q3[i], at[i] +</span><br><span class="line">                                                       boxwidth/<span class="number">2</span>, col = rectCol)</span><br><span class="line">                points(med[i], at[i], pch = pchMed, col = colMed)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    invisible(list(upper = upper, lower = lower, median = med,</span><br><span class="line">                   q1 = q1, q3 = q3))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<hr>
<p>github: <a href="https://github.com/Karobben" target="_blank" rel="noopener">https://github.com/Karobben</a><br>
blog: <a href="http://Karobben.github.io">Karobben.github.io</a><br>
R 语言画图索引: <a href="https://karobben.github.io/R/R-index.html">https://karobben.github.io/R/R-index.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://karobben.github.io/R/edgeR.html" data-id="ckcogixoi00712bfc6t984b2s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/30/tmp/">test</a>
          </li>
        
      </ul>
    </div>
  </div>

  
  <!-- Weather -->
<div id="weather-view-he" ></div>
<script>
WIDGET = {ID: 'HfP68rcshb'};
</script>
<script type="text/javascript" src="https://apip.weatherdt.com/view/static/js/r.js?v=1111"></script>

</aside>

          <!-- Weather Plug -->
        
        <!--git talk-->
        <section id="main">
          <div style='padding-top:10px'>
  <div style="background:white">
    <script src="https://utteranc.es/client.js"
            repo="Karobben/utterances"
            issue-term="pathname"
            theme="preferred-color-scheme"
            crossorigin="anonymous"
            async>
    </script>
  </div>
</div>
<!--git talk-->
  <!-- Link Gitalk 的支持文件  -->
  <!--
    <div>
      <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
      <div id="gitalk-container"></div>     <script type="text/javascript">
          var gitalk = new Gitalk({

          // gitalk的主要参数
              clientID: '96c208ade65e80e3aaac',
              clientSecret: '86e9240674a3815b0ddc31dababdb4998d5562f4',
              repo: 'OAuth-Application',
              owner: 'Karobben',
              admin: ['Karobben'],
              id:window.location.pathname,
          });
          gitalk.render('gitalk-container');
      </script>
    </div>
<!-- Gitalk end -->

        </section>
        <!-- Gitalk end -->

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <span style="float:right; list-style:none">
        <a style="padding: 10px" href="https://karobben.github.io/">Blog</a>
        <a style="padding: 10px" href="https://github.com/Karobben" target="_blank" rel="noopener">GitHub</a>
        <br>
        <a style="padding: 10px" href="https://space.bilibili.com/393056819" target="_blank" rel="noopener">BiliBili</a>
        <a href="mailto:a591465908@outlook.com">Mail me</a>
      </span>
      &copy; Karobben 2021<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
  <span>
    <p align = "center">
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_site_pv">~<span id="busuanzi_value_site_pv"></span>~</span>
    </p>
  </span>
</footer>

    </div>
    <nav id="mobile-nav">
  <!--`
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  -->
  <a class="mobile-nav-link" href="../index.html">Home</a>
  <a class="mobile-nav-link" href="../R/R-index.html">R</a>
  <a class="mobile-nav-link" href="../Python/index.html">Python</a>
  <a class="mobile-nav-link" href="../Linux/index.html">Linux</a>
  <a class="mobile-nav-link" href="../Bioinfor/index.html">Bio-Protocal</a>
  <a class="mobile-nav-link" href="../LearnNotes/index.html">Notes</a>
  <a class="mobile-nav-link" href="../Blog/index.html">Others</a>
</nav>

    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




<!--mermaid module-->

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>



<!-- Searche Module-->
<script src="/js/search.js"></script>
<script src="/js/load.js"></script>
<!-- 这里可能有一些其他原来文件里的代码，也可以没有 -->

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
